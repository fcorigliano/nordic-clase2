const { NODE_COUNTRY_UPDATES, PRODUCTION } = require('frontend-env');
const { getData, initChecker } = require('../utils/update-data');
let countriesData = require('../config/countries.json');

// Set up the updates checker. Can be disabled by setting the NODE_COUNTRY_UPDATES to falsy value
const useUpdates = initChecker(NODE_COUNTRY_UPDATES, true);

const UPDATE_INTERVAL = 60 * 60 * 1000;

function updateCountriesData() {
  getData()
    .then((data) => { countriesData = data; })
    .catch(() => {});
}

if (PRODUCTION && useUpdates) {
  // eslint-disable-next-line no-unused-vars, no-return-assign
  const updateTimer = setInterval(updateCountriesData, UPDATE_INTERVAL);
  updateCountriesData();
}

/**
 * Returns the available data for a single country
 *
 * @param countryId
 * @returns {
 *   id: string,
 *   name: string,
 *   locale: string,
 *   currency_id: string,
 *   decimal_separator: string,
 *   thousands_separator: string,
 *   time_zone: string,
 *   geo_information: object,
 *   states: array
 * }
 */
module.exports = (countryId) => countriesData[countryId];
