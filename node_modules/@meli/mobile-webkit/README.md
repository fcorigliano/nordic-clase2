# Node.js Starter App

![technology Node.js](https://img.shields.io/badge/technology-node-green.svg)

Proyecto del sdk del webkit para las apps nativas (iOS, Android).

## IMPORTANTE: Workflow
* Trabajar sobre develop agregando las nuevas features
* Una vez se decide armar una nueva versión seguir los pasos más abajo en [Deploying a new version](#deploying-new-version)

## Usage

```html
<script type='text/javascript' src='https://http2.mlstatic.com/frontend-assets/mobile-webkit/v1.21.0/mobilewebkit.js'></script>

<script type="text/javascript">

    function requestNativeEcho(strToEcho) {
        MobileWebKit.executeNative({
            // Required, Method to execute on native app
            "method": 'native_echo',

            // Optional, argument to pass to native app
            "args": {
                'text': strToEcho
            },

            // Optional, callback to execute when invocation ends with result or error
            "callback": function(result, error) {
                if (error) {
                    console.log(error);
                    return;
                }
                
                if (!result) {
                    console.log("ERROR: wrong echo result");
                } else {
                    console.log("SUCCESS: echo arrives " + result);
                }
            },

            // Optional, time in millis, default 0 indicating no timeouts
            "timeout": 10,

            // Optional, number of retries before return with error, default 0. Used in conjunction with 'timeout'.
            "retries_on_timeout": 4,

            // Optional, wait time between retries on timeout in millis, default 0. Used in conjunction with 'timeout' and 'retries_on_timeout'.
            "retry_time_on_timeout": 5
        });
    }
</script>
```

## Buildear el sdk JS
1. `fury get mobile-webkit`
2. `cd mobile-webkit`
3. `nvm use 14`
4. `npm install`
6. `npm run build`
7. el file generado queda en `examples/build/mobilewebkit.js`

## Para correr la webview:
1. [Buildear el sdk JS](#buildear-el-sdk-js) que dejará parado dentro del repo root del webkit (`mobile-webkit`)
2. `cd examples`
3. `npm install`
4. `cd ..`
5. `npm run start:example`
6. ingresar a `https://dev.mercadolibre.com.ar:8443/` 

**Please note** that to be able to open any development URL over HTTPS proto on your device, for a single time you need to install Meli development Certificate Authority.
  For this you can run examples with a `ENABLE_DEVCERT_SERVER=true npm run start:example` command and follow [this steps from Nordic documentation](https://nordic.adminml.com/docs/api/Nordic%20Modules/ragnar#webviews).

## Deploying new version

1. Definir que versión va a tener el nuevo deploy.
2. Crear un branch feature/release por ejemplo feature/release-1.0.0 partiendo de master
3. Modificar el package.json con la nueva versión. Es importante porque esto inserta la version en el propio script en el proceso de buildeo.
4. Enviar un pr a master desde el branch de release y en la descripción agregar el siguiente texto "[build][name:<version>]" ejemplo "[build][name:1.0.0]".
5. LLevar los cambios del branch de release a develop
6. El js quedará deployado en `https://http2.mlstatic.com/frontend-assets/mobile-webkit/vVERSION/mobilewebkit.js`
  ejemplo: `https://http2.mlstatic.com/frontend-assets/mobile-webkit/v1.0.0/mobilewebkit.js`
