## connect-kvs
Key-value store express middleware, for Fury Sessions service.

### Install
```
npm install --save connect-kvs
```

### Basic usage
```javascript 1.7
const session = require('express-session');
const KvsStore = require('../lib/connect-kvs')(session);

const options = {
  ttl: 18000, // 30 minutes
  max_retries: 2,
  retry_delay: 40,
  secret: 'mycustomsecret',
  container: 'SM_project-session-test',
};

const store = new KvsStore(options);

store.get(sid, callback);

store.set(sid, plaintext, callback);

store.destroy(sid, callback);
```

### Options

| Option | Required | Default |
| --- | --- | --- |
| ttl | false | 1800 |
| max_retries | false | 3 |
| retry_delay | false | 30 ms |
| secret | false | 'furysessions' |
| container | true | null |


### Encryption 

```
New version: AES-256-GCM
Legacy version: AES-256-CTR (deprecated)
```

### Encryption benchmark

```npm
npm run bench:encrypt
```

```
KvsStore#encryptiv
Raw:
 > 76.69322709163346
 > 79.44389275074478
 > 78.66273352999016
 > 80.59701492537313
Average (mean) 78.84921707443539

KvsStore#encrypt
Raw:
 > 27.722772277227723
 > 27.83300198807157
 > 28.48722986247544
 > 28.182701652089406
Average (mean) 28.056426444966036

Winner: KvsStore#encryptiv
Compared with next highest (KvsStore#encrypt), it's:
64.42% faster
2.81 times as fast
0.45 order(s) of magnitude faster
QUITE A BIT FASTER
```

### Decryption benchmark

```npm
npm run bench:decrypt
```

```
KvsStore#decrypt
Raw:
 > 128.58555885262118
 > 125.24850894632206
 > 141.71656686626747
 > 135.86413586413587
Average (mean) 132.85369263233665

KvsStore#decryptIv
Raw:
 > 127.87212787212788
 > 134.52027695351137
 > 128.2306163021869
 > 134.86513486513488
Average (mean) 131.37203899824024

Winner: KvsStore#decrypt
Compared with next highest (KvsStore#decryptIv), it's:
1.12% faster
1.01 times as fast
0 order(s) of magnitude faster
BASICALLY THE SAME
```

### Tests

```npm
npm test
```

#### For more information...
frontendcore@mercadolibre.com
