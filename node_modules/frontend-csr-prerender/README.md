# Client Side Rendering (CSR) Pre-rendering

 Es un middleware que ayuda al uso de [CSR with Pre-rendering](https://developers.google.com/web/updates/2019/02/rendering-on-the-web#wrapup) soportando ETAG, prefetchs y preloads.


## Instalación

```
npm install frontend-csr-prerender
```

## Uso

Tiene que usar [Ragnar](https://github.com/mercadolibre/frontend-ragnar) debido a que se complementa con el middleware [preventRenderByEtag](https://github.com/mercadolibre/frontend-ragnar/tree/develop#preventrenderbyetag)

```js
/**
 * Module dependencies
 */
const router = require('ragnar').router();

const { csrPrerenderMiddleware } = require('frontend-csr-prerender');

// or legacy way
const csrPrerenderMiddleware = require('frontend-csr-prerender');

router.get('/mercado-puntos', csrPrerenderMiddleware, render);

/**
 * Expose router
 */
module.exports = router;
```

### Configuración
Se podrá generar una configuración custom para setear Prefetches y Preloads, dicha configuracion es un `function` y recibe como parametros el request y response para poder tomar las decisiones correspondientes, dicha función debe retornar un objeto como lo explica en el ejemplo mas abajo.

`prefetches`: (`string[]`): Las vistas que se necesitan hacer prefetch.

`preloads`:(`string[]`): Cualquier request que se necesite inmediatamente deberá ser cargado en este array

#### Ejemplo

```js
/**
 * Module dependencies
 */
const router = require('ragnar').router();

const { csrPrerenderMiddleware } = require('frontend-csr-prerender');

// or legacy way
const csrPrerenderMiddleware = require('frontend-csr-prerender');

const customConfig = (req, res) => { 
  if (req.platform.siteId === 'MLA') {
    return {
      prefetches: ['https://www.mercadolibre.com.ar/help', 'https://www.mercadolibre.com.ar/login'],
      preloads: ['https://www.mercadolibre.com.ar/api/data', 'https://www.mercadolibre.com.ar/api/hub'],  
    }
  }

  return {
    prefetches: ['https://www.mercadolibre.com.ar/help', 'https://www.mercadolibre.com.ar/login'],
    preloads: ['https://www.mercadolibre.com.ar/api/data', 'https://www.mercadolibre.com.ar/api/hub'],  
  }
};

router.get('/mercado-puntos', csrPrerenderMiddleware(customConfig), render);

/**
 * Expose router
 */
module.exports = router;
```

## License

Copyright © 2019.
