const statsdInternal = require('frontend-statsd/internal');
const loggerFactory = require('frontend-logger');
const { STATS_PREFIX } = require('./constants/stats');

const logger = loggerFactory('frontend-config');

const error = ({ log = false, ...options }) => {
  // Logs warning on app logs (kibana)
  const loggerTags = options.environmentId
    ? {
      ...options.tags,
      environmentId: options.environmentId,
    }
    : options.tags;
  if (log) {
    logger.warn(options.message, loggerTags);
  }

  // Send stats to frontend-core dashboard
  const statsTags = options.environmentId
    ? {
      environmentId: options.environmentId,
    }
    : {};
  statsdInternal.histogram(`${STATS_PREFIX}.${options.statName}`, 1, statsTags);
};

const info = ({ log = false, ...options }) => {
  if (log) {
    logger.info(options.message);
  }
  const statsTags = options.tags ? options.tags : {};
  statsdInternal.histogram(`${STATS_PREFIX}.${options.statName}`, 1, statsTags);
};

module.exports = {
  error,
  info,
};
