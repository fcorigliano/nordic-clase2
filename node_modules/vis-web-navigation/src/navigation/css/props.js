const {
  getValue,
  getEnvironment,
  addUpdateHandler,
} = require('classified-navigation-config');

const propsMapper = (props) => {
  const configGetter = ({
    key,
    platform,
  }) => getValue({
    key,
    req: props.req,
    platform,
  });

  const configEnvironment = getEnvironment(props.req);

  const addConfigUpdateHandler = addUpdateHandler;

  return {
    deviceType: (props.device || {}).type,
    platformId: (props.platform || {}).id,
    cdn: props.cdn,
    feConfigEnvironment: props.feConfigEnvironment,
    siteId: (props.platform || {}).siteId,
    browser: props.browser,
    navigationType: props.type,
    firstRequestInlineStyles: !!(props.criticalPath || {}).key,
    embedCss: props.embedCss,
    configGetter,
    configEnvironment,
    addConfigUpdateHandler,
  };
};

module.exports = propsMapper;
