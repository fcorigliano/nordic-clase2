/* eslint-disable no-nested-ternary, no-unused-expressions, no-param-reassign */
(function (win) {
  function Messages() {
    return this;
  }

  Messages.prototype.allowedHashes = ['#WM', '#CM', '#WAPM', '#WRPM'];

  Messages.prototype.actionString = function () {
    return 'Entendido';
  };

  Messages.prototype.messageString = function () {
    var portuguese = this.siteId === 'MLB' || this.siteId === 'MPT';
    var message = '';

    if (win.location.hash === '#WM') {
      var WMfirstPart = portuguese
        ? 'Pronto, {FIRST_NAME}. Você se cadastrou! Entre com o seu e-mail {EMAIL} ou com o seu usuário {NICKNAME} (<a href="{MODIFY_URL}">Modificar usuário</a>)'
        : 'Listo, {FIRST_NAME}. ¡Te registraste! ingresa con tu e-mail {EMAIL} o con tu usuario {NICKNAME} (<a href="{MODIFY_URL}">Modificar usuario</a>)';
      var WMsecondPart = portuguese
        ? ' <a href="{DOCS_URL}">Saiba a documentação necessária</a> para que as suas vendas sejam faturadas em nome da sua empresa'
        : ' <a href="{DOCS_URL}">Conoce la documentación necesaria</a> para facturar tus ventas a nombre de tu empresa';
      message = this.user.company ? WMfirstPart + WMsecondPart : WMfirstPart;
    } else if (win.location.hash === '#CM') {
      var CMfirstPart = portuguese ? '{FIRST_NAME}, a sua conta foi confirmada!' : '¡{FIRST_NAME}, confirmaste tu cuenta!';
      var CMsecondPart = this.siteId === 'MLB'
        ? ' Você já pode acessar todas as funcionalidades do Mercado Livre, Mercado Envios, Mercado Pago, Mercado Shops e Mercado Livre Publicidade.'
        : this.siteId === 'MLA' || this.siteId === 'MLM'
          ? ' Ya puedes acceder a todas las funcionalidades de Mercado Libre, Mercado Envíos, Mercado Pago, Mercado Shops y Mercado Libre Publicidad.'
          : this.siteId === 'MLV' || this.siteId === 'MCO' || this.siteId === 'MLC'
            ? ' Ya puedes acceder a todas las funcionalidades de Mercado Libre, Mercado Pago, Mercado Shops y Mercado Libre Publicidad.'
            : this.siteId === 'MLU' || this.siteId === 'MEC' || this.siteId === 'MPE'
              ? ' Ya puedes acceder a todas las funcionalidades de Mercado Libre y Mercado Libre Publicidad.'
              : ' Ya puedes acceder a todas las funcionalidades de Mercado Libre.';
      message = CMfirstPart + CMsecondPart;
    } else if (win.location.hash === '#WAPM') {
      message = portuguese
        ? 'Muito bom, {FIRST_NAME}. Você já pode aproveitar o seu frete grátis!'
        : 'Bravo, {FIRST_NAME}. ¡Ya puedes disfrutar de tu envío gratis!';
    } else if (win.location.hash === '#WRPM') {
      message = portuguese
        ? '{FIRST_NAME}, você se cadastrou com o e-mail {EMAIL}. Aproveite o seu frete grátis!'
        : '{FIRST_NAME}, te registraste con el mail {EMAIL} ¡Ya puedes disfrutar de tu envío gratis!';
    }

    message = message.replace('{FIRST_NAME}', this.user.name)
      .replace('{NICKNAME}', this.user.nickname)
      .replace('{EMAIL}', this.user.email)
      .replace('{MODIFY_URL}', this.urls.modifyUserUrl)
      .replace('{DOCS_URL}', this.urls.docsUrl);
    return message;
  };

  Messages.prototype.showMessageForUser = function (options) {
    this.user = options.user;
    this.urls = options.urls;
    this.siteId = options.siteId;
    if (this.allowedHashes.indexOf(win.location.hash) !== -1) {
      this.render({
        message: this.messageString(),
        action: this.actionString(),
        type: 'success',
        target: document.querySelector('header')
      });
    }
  };

  Messages.prototype.render = function (options) {
    var messageContainer = document.createElement('div');
    messageContainer.className = 'ui-message ui-message--has-icon ui-message--post-registration ui-message--' + options.type;

    var messageBounds = document.createElement('div');
    messageBounds.className = 'ui-message--bounds';
    messageContainer.appendChild(messageBounds);

    var messageIcon = document.createElement('span');
    messageIcon.className = 'ui-message__icon';
    messageBounds.appendChild(messageIcon);

    var messageContent = document.createElement('p');
    messageContent.className = 'ui-message__text';
    messageContent.innerHTML = options.message;
    messageBounds.appendChild(messageContent);

    var messageClose = document.createElement('div');
    messageClose.className = 'ui-message__close';
    messageClose.onclick = function () {
      messageContainer.remove();
    };
    messageBounds.appendChild(messageClose);

    options.target
      ? options.target.parentNode.insertBefore(messageContainer, options.target.nextSibling)
      : null;
  };

  Messages.prototype.init = function (config) {
    // This functions exists only for backwards compatibility
    var hashIsNotAllowed = this.allowedHashes.indexOf(config.hash) === -1;
    if (hashIsNotAllowed) {
      console.warn('messages.init() has been deprecated. Messages for user registration feedback are handled automatically. Other hashes are ignored');
    }
  };

  var messages = new Messages();
  if (win.freya) {
    win.freya.messages = messages;
  }
  if (win.meli) {
    win.meli.messages = messages;
  }
}(window));
