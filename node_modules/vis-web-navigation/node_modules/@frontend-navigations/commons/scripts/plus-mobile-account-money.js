(function () {
  var headerSwitch = document.querySelector('#nav-header-menu-switch');
  if (!headerSwitch) return;

  var requestAccountMoney = function (event) {
    var accountMoneyElement = document.querySelector('#nav-header-menu-mobile-account-money-detail');
    if (!accountMoneyElement) return;
    var xhr = new XMLHttpRequest();
    xhr.onload = function () {
      if (xhr.status === 200) {
        var response = xhr.response || xhr.responseText;
        var accountMoney = JSON.parse(response);
        accountMoneyElement.textContent = accountMoney.currency_symbol + ' ' + accountMoney.amount.toString();
        document.querySelector('#nav-header-menu-mobile-account-money').classList.add('nav-header-menu-mobile-with-money');
      }
    };
    xhr.open('GET', accountMoneyElement.getAttribute('data-endpoint'), true);
    xhr.withCredentials = true;
    xhr.send();
    headerSwitch.removeEventListener(event.type, requestAccountMoney);
  };

  headerSwitch.addEventListener('change', requestAccountMoney);
  if (headerSwitch.checked) {
    requestAccountMoney({ type: 'change' });
  }
}());
