(function () {
  const $navHeaderUserSwitch = document.getElementById('nav-header-user-switch');
  const $navHeaderUserMenu = document.getElementById('nav-header-user-menu-nav');
  let isNavHeaderHover = false;

  const $navHeaderUserAvatar = document.getElementById('nav-header-user-trigger-avatar');

  function hideMenu() {
    $navHeaderUserSwitch.checked = false;
  }

  if (!$navHeaderUserSwitch || !window || !window.addEventListener) return;

  if ($navHeaderUserAvatar) {
    // open menu on hover
    $navHeaderUserAvatar.addEventListener('mouseover', () => {
      // This function can be found on the file navigation/client/effects.js inside frontend-navigations
      if (window.hideNavigationListContainers) {
        window.hideNavigationListContainers();
      }
      $navHeaderUserSwitch.checked = true;
      isNavHeaderHover = false;
    }, false);

    // close menu if not was hover userMenu
    $navHeaderUserAvatar.addEventListener('mouseleave', () => {
      setTimeout(() => {
        if (!isNavHeaderHover) {
          hideMenu();
        }
      }, 300);
    }, false);

    $navHeaderUserMenu.addEventListener('mouseenter', () => {
      isNavHeaderHover = true;
    }, false);

    $navHeaderUserMenu.addEventListener('mouseleave', () => {
      isNavHeaderHover = false;
      hideMenu();
    }, false);
  }

  $navHeaderUserSwitch.addEventListener('change', function () {
    // hide menu when page is closed
    if (this.checked) {
      window.addEventListener('beforeunload', hideMenu, false);
    } else {
      window.removeEventListener('beforeunload', hideMenu, false);
    }
  }, false);
}());
