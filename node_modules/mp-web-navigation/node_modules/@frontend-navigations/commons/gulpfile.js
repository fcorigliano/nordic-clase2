/**
 * Dependencies
 */
const gulp = require('gulp');
const { watch } = require('gulp');
const loadPlugins = require('gulp-load-plugins');
const { version } = require('./package.json');

const $ = loadPlugins();

const srcFiles = `./font-icons/*.svg`;
const buildFolder = `./font-build`;

gulp.task('minify', () => gulp.src([
  'eot',
  'svg',
  'ttf',
  'woff',
  'woff2'
].map(extension => `${buildFolder}/*.${extension}`))
  .pipe($.fontmin())
  .pipe(gulp.dest(`../../object-storage-assets/ui-navigation/${version}`)));

gulp.task('build', () => gulp.src(srcFiles)
  .pipe($.iconfont({
    fontName: 'navigation',
    normalize: true,
    fontHeight: 1024,
    prependUnicode: true,
    formats: ['ttf', 'eot', 'woff', 'woff2', 'svg']
  }))
  .pipe(gulp.dest(buildFolder)));

const buildIconFonts = gulp.series('build', 'minify');

gulp.task('buildIconFonts', buildIconFonts);

gulp.task('watch', () => watch(srcFiles, { ignoreInitial: false }, buildIconFonts));