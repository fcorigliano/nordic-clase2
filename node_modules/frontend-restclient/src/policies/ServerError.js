const RetryPolicy = require('./RetryPolicy');

/**
* Implements the server error policy. This policy retries in case of errors with status codes >= 500, only in idempotent methods.
* @extends RetryPolicy
*/
class ServerErrorPolicy extends RetryPolicy {
  static methods = [
    'get',
    'head',
    'options',
  ]

  /**
  * Define if the given error is valid candidate for retry
  * @summary If the requested method is one of the idempotent methods and the status code is >= 500, it should retry
  * @param {error} Object - The error object
  * @returns {boolean} Indicates if should retry or not
  */
  static hasToRetry(error) {
    const { response } = error;

    if (this.methods.includes(error.config.method.toLowerCase())) return response.status >= 500;

    return false;
  }
}


module.exports = ServerErrorPolicy;
