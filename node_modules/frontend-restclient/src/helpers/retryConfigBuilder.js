const defaults = require('../../config/defaults');


/**
 * Generate retry configs for a given request
 * @param config Object
 * @param instanceConfig Object
 */

module.exports = (config, instanceConfig, defaultRetryPolicy = defaults.retry.policy) => {
  const retryConfig = { ...(instanceConfig.retry ? instanceConfig.retry : {}), ...config.retry };

  // If retry is disabled on last level and on both levels dosent make sense to merge them
  if (config.retry === false || (!config.retry && !instanceConfig.retry)) {
    return false;
  }

  // If retry hasn't been disabled, but still don't have a policy
  if (retryConfig && !retryConfig.policy) {
    retryConfig.policy = defaultRetryPolicy;
  }

  return retryConfig;
};
