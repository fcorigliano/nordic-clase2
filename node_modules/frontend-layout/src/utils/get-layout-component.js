const React = require('react');
const Script = require('frontend-script');
const { agentLoader } = require('perfill-agent');
const AttributionScript = require('nordic-attribution');

// Use transpiled Layout component
// eslint-disable-next-line import/no-unresolved,import/extensions
const Layout = require('../../lib/server/Layout');
const { getFocusIndicatorCss } = require('../constants/focus-indicator-css');

const defaultPrepareToRender = () => Promise.resolve();

function getLayoutComponent(options, req) {
  const Component = options.layout || Layout;

  const toReturn = (props) => React.createElement(
    React.Fragment,
    null,
    getFocusIndicatorCss(req),
    React.createElement(Component, props, null),
    props.perfill
      && React.createElement(Script, null, agentLoader(props.perfill)),
    React.createElement(AttributionScript, props),
  );

  toReturn.prepareToRender = Component.prepareToRender || defaultPrepareToRender;

  return toReturn;
}

module.exports = getLayoutComponent;
