const featureNativeVersion = require('../../constants/feature-native-version');

function isScriptEnabled(req, initiative) {
  try {
    const initiativeConfig = featureNativeVersion[initiative];
    const versionConfig = initiativeConfig && initiativeConfig[req.device.nativeApp.name]
      ? initiativeConfig[req.device.nativeApp.name][req.device.nativeApp.os]
      : null;

    if (!versionConfig) {
      return false;
    }

    const [major, minor] = req.device.nativeApp.version.split('.').map((v) => parseInt(v, 10));

    return versionConfig.major < major || (versionConfig.major === major && versionConfig.minor <= minor);
  } catch (ex) {
    return false;
  }
}

module.exports = {
  isScriptEnabled,
};
