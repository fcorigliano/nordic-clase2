const Newrelic = require('newrelic');
const { getFullUrlFromReq } = require('../url');

function isWebkitLanding(req) {
  const isWebview = req.device.webView;
  const hasWebkitLandingHeader = req.headers && !!req.headers['x-webkit-landing'];

  if (isWebview && !hasWebkitLandingHeader) {
    Newrelic.recordCustomEvent('NordicWebviews', {
      isWebview,
      isWebkitLanding: hasWebkitLandingHeader,
      error: 'NOT_WEBKIT_LANDING_HEADER',
      url: getFullUrlFromReq(req),
    });
  }

  return isWebview;
}

module.exports = {
  isWebkitLanding,
};
