#!/usr/bin/env node

const readline = require('readline');
const { installCertificateAuthority } = require('../src/certificate-authority');

let error;
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

rl.question('This command will install a CA certificate to your system keychain. You will be prompted for a sudo password. Are you want to proceed? [Yn]', async (res) => {
  const response = res && res.toLowerCase();

  if (response && (response === 'yes' || response === 'y')) {
    try {
      await installCertificateAuthority();
    } catch (err) {
      error = err.message;
      console.log(`An error occurred during installation: ${error}`);
    }
  } else {
    error = 'declined';
    console.log('You have refused the installation.');
  }

  rl.close();
});

rl.on('close', function() {
  if(!error) {
    console.log('You have successfully installed the certificate! :)');
  }
  process.exit(0);
});
