# frontend-devcert

# Table of Contents
- [Description](#description)
- [Install](#install)
- [Usage](#usage)
- [Development](#development)
- [Tests](#tests)
- [Contributing](#contributing)
- [Changelog](#changelog)

## Description

> Green certificates for your development environment

## Install
```
npm install --save frontend-devcert
```

**Warning**: Additional step may be required.

After installation of `frontend-devcert`, in your project will be available a special binary that installs a development Certificate Authority (CA) used for signing of domain certificates. Execute it for a single time to install our CA to your system, without this step all certificates generated by `frontend-devcert` will be untrusted. It works for Linux and macOS, Windows currently is unsupported.

```
./node_modules/.bin/install-devcert-ca
```

## Usage

The main goal of `frontend-devcert` is to generate self-signed certificate for provided domain, which nevertheless can be trusted by browsers due to the presence of our CA in operating system.

### `certificateFor(domain)` - generate a certificate signed with MeliDev CA for provided domain

Use the output of `certificateFor` as options while creating https server:

```js
const express = require('express');
const https = require('https');
const { certificateFor } = require('frontend-devcert');

const app = express();
const ssl = await certificateFor('localhost.com.ar');
const server = https.createServer(ssl, app).listen(8443);
```

The method indicated above only works with a single domain, if your app is running on a multiple domains consider using a `SNICallback` instead of direct `key` and `cert` parameters:
```js
const express = require('express');
const https = require('https');
const { certificateFor } = require('frontend-devcert');

const app = express();
// `certificateFor` is async
const getCertificateFor = async domain => await certificateFor(domain);
// `certificateFor` may be used directly in tls.createSecureContext()
// since it returns a map with the `cert` and `key` keys 
const server = https.createServer({
  SNICallback: async (domain, cb) => {
    cb(null, tls.createSecureContext(await getCertificateFor(domain)));
  },
}, app).listen(8443);
```

### `getCACertificate()` - return a raw content of MeliDev CA

It may be useful for sharing the MeliDev CA with systems, such as iOS or Android emulator, where `sudo` command cannot be executed directly to install the required CA.

```js
const express = require('express');
const { getCACertificate } = require('frontend-devcert');

const app = express();

app.get('/melidev.cer', function (req, res) {
  const cert = getCACertificate();
  res.set('Content-Type', 'application/x-x509-ca-cert');
  res.status(200).send(cert);
});
```

### Development

1) Install dependencies:

```
npm install 
```

2) Build and run the example:

```
npm run start:examples
```

3) Navigate to:

```
https://localhost.com.ar:8443/
```

4) To install MeliDev CA on an external device navigate to:

```
http://localhost.com.ar:8080/melidev.cer
```

#### MeliDev CA renovation

Current CA is valid for a 5 years, up to February 2026. To renovate the certificate use the next commands:

```
openssl genrsa -out ./ca/private-key.key
openssl req -new -x509 -config ./openssl-configurations/certificate-authority-self-signing.conf -key ./ca/private-key.key -out ./ca/certificate.cert -days 1825
```

#### Manual CA installation

MeliDev CA can be installed manually without the using of `./node_modules/.bin/install-devcert-ca` with the next command:

```
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain -p ssl -p basic ./ca/certificate.cert
```

### Tests
```npm
npm test
```

## Contributing

In order to contribute to this library, you must read [this guide](CONTRIBUTING.md) first.

## Changelog

We keep changes to our codebase [here](CHANGELOG.md)
