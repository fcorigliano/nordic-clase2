const path = require('path');
const applicationConfigPath = require('application-config-path');

const VALID_IP = /(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}/;
const VALID_DOMAIN = /^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.?)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]$/i;

// Platform shortcuts
const isMac = process.platform === 'darwin';
const isLinux = process.platform === 'linux';
// const isWindows = process.platform === 'win32';

// Common paths
const applicationName = 'frontend-devcert';
const configDir = applicationConfigPath(applicationName);
function configPath(...pathSegments) {
  return path.join(configDir, ...pathSegments);
}

const rootCADir = configPath('certificate-authority');
const rootCAKeyPath = configPath('certificate-authority', 'private-key.key');
const rootCACertPath = configPath('certificate-authority', 'certificate.cert');

const domainsDir = configPath('domains');
const pathForDomain = (domain, ...pathSegments) => path.join(domainsDir, domain, ...pathSegments);

const caVersion = 1;
const caVersionFile = configPath('frontend-devcert-ca-version');
const opensslSerialFilePath = configPath('certificate-authority', 'serial');
const opensslDatabaseFilePath = configPath('certificate-authority', 'index.txt');

module.exports = {
  configDir,
  configPath,
  isMac,
  isLinux,
  // isWindows,
  VALID_IP,
  VALID_DOMAIN,
  caVersion,
  caVersionFile,
  opensslDatabaseFilePath,
  opensslSerialFilePath,
  rootCADir,
  rootCAKeyPath,
  rootCACertPath,
  domainsDir,
  pathForDomain,
};
