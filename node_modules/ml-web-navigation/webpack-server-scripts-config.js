const nodeExternals = require('webpack-node-externals');
const babel = require('frontend-building_blocks/babel');
const {
  createConfig,
  customConfig,
  entryPoint,
  setOutput,
} = require('frontend-building_blocks');
const { join } = require('path')

module.exports = createConfig([
  entryPoint({
    index: './src/index.js',
  }),
  babel({
    sourceType: 'unambiguous',
    presets: [
      '@babel/preset-react',
    ],
    plugins: ['@babel/plugin-proposal-object-rest-spread'].concat(process.env.NODE_ENV === 'production' ? [
      '@babel/plugin-transform-react-constant-elements',
      '@babel/plugin-transform-react-inline-elements',
      'babel-plugin-transform-react-remove-prop-types',
    ] : []),
  }),
  customConfig({
    target: 'node',
    externalsPresets: {
      node: true,
    },
    externals: [
      nodeExternals(),
    ],
    node: {
      __dirname: false,
    },
  }),
  setOutput({
    libraryTarget: 'commonjs2',
    path: join(__dirname, 'lib'),
  }),
]);
