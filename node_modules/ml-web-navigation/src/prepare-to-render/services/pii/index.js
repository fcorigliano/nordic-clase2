const factory = require('@frontend-navigations/commons/prepare-to-render/services/navigation-pii-data-factory');
const { entityTypes } = require('@frontend-navigations/commons/constants/pii');
const logger = require('../logger');

module.exports = factory({
  logger,
  userProperties: {
    names: {
      preferred: true,
      brand: true,
    },
    registration_identifiers: {
      email: {
        address: true,
      },
    },
    entity_type: true,
  },
  mapper: (piiData) => {
    const piiDataWithDefault = piiData || {};
    const namesWithDefault = piiDataWithDefault.names || {};
    const isUserCompany = piiDataWithDefault.entity_type
      ? piiDataWithDefault.entity_type === entityTypes.company
      : undefined;
    return {
      preferredName: (isUserCompany && namesWithDefault.brand) || namesWithDefault.preferred,
      email: ((piiDataWithDefault.registration_identifiers || {}).email || {}).address,
      isUserCompany,
    };
  },
});
