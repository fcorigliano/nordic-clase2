/* eslint-disable func-names, strict, prefer-arrow-callback, no-var */
(function (doc) {
  'use strict';

  var header = doc.querySelector('.nav-header');
  var searchInput = doc.querySelector('.nav-search-input');
  var searchForm = doc.querySelector('.nav-search');
  var menuSwitch = doc.getElementById('nav-header-menu-switch');
  var clearBtn = doc.querySelector('.nav-search-clear-btn');
  var searchInputHasFocus = false;
  var searchInputFocusTimer;

  function checkInputText() {
    clearTimeout(searchInputFocusTimer);

    searchInputFocusTimer = setTimeout(function () {
      searchForm.classList[searchInput.value.length
      && searchInputHasFocus ? 'add'
        : 'remove']('nav-search--has-text');
    }, 100);
  }

  searchInput.addEventListener('focus', function () {
    header.classList.add('nav-header-has-search-active');
    header.classList.remove('nav-header--is-leave');
    menuSwitch.checked = false;
    searchInputHasFocus = true;
    checkInputText();

    setTimeout(function () {
      header.classList.add('nav-header--is-enter');
    }, 1);
  });

  searchInput.addEventListener('blur', function () {
    header.classList.remove('nav-header--is-enter');
    header.classList.add('nav-header--is-leave');
    searchInputHasFocus = false;
    checkInputText();
    setTimeout(function () {
      if (!searchInputHasFocus) {
        header.classList.remove('nav-header-has-search-active');
      }
    }, 100);
  });


  searchInput.addEventListener('input', checkInputText);
  if (clearBtn) {
    clearBtn.addEventListener('mousedown', function (e) {
      e.preventDefault();
      searchInput.value = '';
      checkInputText();
      setTimeout(function () {
        searchInput.focus();
      }, 50);
    }, false);
  }
}(document));
