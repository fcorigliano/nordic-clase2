/* eslint-disable security/detect-object-injection */
const i18n = require('./i18n');

const OVERDUE = 'overdue';
const loanProps = (props) => {
  const { loansInfo, platform, navigationUrls } = props;

  const AVAILABLE_SITES = {
    MLA: 'MLA',
    MLB: 'MLB',
    MLM: 'MLM',
  };

  const LANG_BY_SITE = {
    [AVAILABLE_SITES.MLA]: 'es_AR',
    [AVAILABLE_SITES.MLM]: 'es_MX',
    [AVAILABLE_SITES.MLB]: 'pt',
    DEFAULT: 'es',
  };

  const baseProps = {
    show: false,
  };

  if (loansInfo) {
    const installmentStatus = i18n[loansInfo.next_installment_status];
    baseProps.show = loansInfo.loan_status === OVERDUE && !!installmentStatus;

    if (baseProps.show) {
      const lang = AVAILABLE_SITES[platform.siteId] ? LANG_BY_SITE[platform.siteId] : LANG_BY_SITE.DEFAULT;
      const installmentsPlurality = loansInfo.next_installments_number === 1 ? 'singular' : 'plural';

      baseProps.text = installmentStatus
                       && installmentStatus[lang]
                       && installmentStatus[lang][installmentsPlurality]
                       && installmentStatus[lang][installmentsPlurality]
                         .replace('{N}', loansInfo.next_installments_number);
      baseProps.link = navigationUrls.credits ? navigationUrls.credits.link : '';
    }
  }

  return baseProps;
};

module.exports = loanProps;
