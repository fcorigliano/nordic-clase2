/* eslint-disable nordic/i18n-jsx-no-literals */
const React = require('react');
const ShallowRenderer = require('react-test-renderer/shallow');

const downloadAppScripts = text => [{
  type: 'html',
  typeData: `<script>console.log('${text}')</script>`,
}];

const baseProps = {
  type: 'plus',
  platform: {
    siteId: 'MLA',
    id: 'ML',
    domain: 'mercadolibre.com.ar',
    countryId: 'AR',
  },
  feConfigEnvironment: 'test',
  req: {},
  urls: {
    baseDomain: { link: 'https://www.mercadolibre.com.ar' },
    mainDomain: { link: 'https://www.mercadolibre.com.ar' },
    login: {
      link: 'https://www.mercadolibre.com/jms/mla/lgz/login',
      name: 'Ingresá',
    },
    changeNickName: {
      link: 'https://myaccount.mercadolibre.com.ar/profile/changeNickName',
      name: 'Modificar Nombre',
    },
    logout: {
      link: 'https://www.mercadolibre.com/jms/mla/lgz/logout',
      name: 'Salir',
    },
    credits: {
      link: 'https://www.mercadolibre.com.ar/credits',
      name: 'Mercado Créditos',
    },
    purchases: {
      link: 'https://www.mercadolibre.com.ar/compras',
      name: 'Compras',
    },
    home: { link: 'https://www.mercadolibre.com.ar/', name: 'Inicio' },
    myAccount: {
      link: 'https://www.mercadolibre.com.ar/my-account',
      name: 'Mi cuenta',
    },
    bookmarks: {
      link: 'https://www.mercadolibre.com.ar/bookmarks',
      name: 'Favoritos',
    },
    syi: {
      link: 'https://www.mercadolibre.com.ar/vender',
      name: 'Vender',
    },
    registration: {
      link: 'https://www.mercadolibre.com.ar/registration',
      name: 'Creá tu cuenta',
    },
    listing: { link: 'https://www.mercadolibre.com.ar/listing' },
    cpLocation: {
      link: 'https://www.mercadolibre.com.ar/navigation/addresses-hub',
      name: 'Enviar a',
    },
    cart: { link: 'https://www.mercadolibre.com.ar/gz/cart', name: 'Carrito' },
    jobs: {
      link: 'https://www.mercadolibre.com.ar/jobs',
      name: 'Trabaja con nosotros',
    },
    loyalty: {
      link: 'https://www.mercadolibre.com.ar/puntos',
      name: 'Mercado Puntos',
    },
    downloadAppLanding: {
      link: 'https://www.mercadolibre.com.ar/download-app-landing',
      name: 'App Landing',
    },
    downloadAppStore: {
      link: 'https://www.mercadolibre.com.ar/download-app-store',
      name: 'App Store',
    },
    help: { link: 'https://www.mercadolibre.com.ar/ayuda', name: 'Ayuda' },
    helpMain: { link: 'https://www.mercadolibre.com.ar/ayuda', name: 'Ayuda' },
    honeyPath: { link: 'https://hp.mercadolibre.com/', name: 'Mercado Libre' },
  },
  actualLocation: 'https://www.mercadolibre.com.ar/',
  labels: {
    headTitle: 'Mercado Libre',
  },
  cdn: {
    name: 'cdn-name',
    link: 'https://ml.mercadolibre.com',
    cssFileSuffix: '',
  },
  defaultNavigationCSS: false,
  modelessBoxVersion: '-1',
  navigationFeatures: {
    snackbarVersion: '1.0.0',
    searchBoxVersion: '1.0.0',
    modalVersion: '1.0.0',
    categoriesVersion: '1.0.0',
    userMenuVersion: '1.0.0',
    onBoardingCPVersion: '1.0.0',
  },
  configSchema: {
    mobileHeaderMenu: { guest: [['home']], logged: [['home']] },
    footerAccess: {
      hidden: false,
      title: 'Mas información',
      items: [
        {
          id: 'about',
          title: 'Acerca de',
          items: ['institucional', 'investor', 'trends'],
        },
        {
          id: 'otherSites',
          title: 'Otros sitios',
          items: [
            'developers',
            'mpago',
            'mshops',
            'menvios',
            'mclics',
            'mideas',
          ],
        },
        {
          id: 'help',
          title: 'Ayuda',
          items: ['helpBuy', 'helpSell', 'helpContact', 'helpSecurity', 'helpClaims'],
        },
        {
          id: 'socialNetworks',
          title: 'Redes sociales',
          items: ['twitter', 'facebook', 'instagram', 'youtube'],
        },
        {
          id: 'myAccount',
          title: 'Mi cuenta',
          items: ['myAccount', 'bookmarks', 'syi'],
          itemsGuest: ['login', 'syi'],
        },
      ],
    },
    footer: {
      items: ['jobs', 'tyc', 'politics', 'helpMain'],
    },
    i18n: {
      inputLabel: 'Ingresá lo que quieras encontrar',
      placeholder: 'Buscar productos, marcas y más…',
      iconLabel: 'Buscar',
      searchInputLabel: 'Ingresá lo que quieras encontrar',
      searchPlaceholder: 'Buscar productos, marcas y más…',
      searchIconLabel: 'Buscar',
      searchPlaceholderMobile: 'Estoy buscando..',
    },
  },
  device: {
    type: 'mobile',
    mobile: true,
    desktop: false,
    lowEnd: false,
    osName: 'android',
  },
  browser: {
    name: 'chrome',
    major: '80',
    support: {
      webp: false,
      prefetch: true,
      preconnect: true,
      pushNotifications: false,
      serviceWorkers: false,
      brotli: true,
      sameSite: true,
    },
  },
  cartInfo: {
    badge_icon: { quantity: 0 },
    location: { type: 'address', value: '1014518121' },
  },
  features: {
    menuShippingLocation: {
      shippingMobileContext: 'cart',
      isShippingLocation: true,
    },
  },
  notificationsInfo: { count: 0 },
  cpInfo: {
    label: 'Enviar a Capital Federal',
    title: 'Enviar a',
  },
  exhibitorInfo: {
    permalink: 'https://www.mercadolibre.com.ar/exhibitor',
    picture: 'https://www.mercadolibre.com.ar/exhibitor.jpeg',
    title: 'Exhibitor',
  },
  downloadApp: {
    'page-top': downloadAppScripts('page-top'),
    'page-bottom': downloadAppScripts('page-bottom'),
    'header-top': downloadAppScripts('header-top'),
    'header-bottom': downloadAppScripts('header-bottom'),
    'footer-top': downloadAppScripts('footer-top'),
    'footer-bottom': downloadAppScripts('footer-bottom'),
  },
  overrides: {},
  navigationPIIData: {},
};

baseProps.navigationUrls = baseProps.urls;

const config = {
  footerAccess: {
    title: 'Más información',
    items: [
      {
        id: 'about',
        title: 'Acerca de',
        items: [{ link: 'institucional' }, { link: 'investor' }, { link: 'trends' }],
      },
      {
        id: 'otherSites',
        title: 'Otros sitios',
        items: [{ link: 'developers' }, { link: 'mpago' }, { link: 'mshops' }, { link: 'menvios' }, { link: 'mclics' }, { link: 'mideas' }],
      },
      {
        id: 'help',
        title: 'Ayuda',
        items: [{ link: 'helpBuy' }, { link: 'helpSell' }, { link: 'helpContact' }, { link: 'helpSecurity' }],
      },
      {
        id: 'socialNetworks',
        title: 'Redes sociales',
        items: [{ link: 'twitter', target: '_blank' }, { link: 'facebook', target: '_blank' }, { link: 'instagram', target: '_blank' }, { link: 'youtube', target: '_blank' }],
      },
      {
        id: 'myAccount',
        title: 'Mi cuenta',
        items: [{ link: 'myAccount' }, { link: 'bookmarks' }, { link: 'syi' }],
        itemsGuest: [{ link: 'login' }, { link: 'syi' }],
      },
    ],
  },
  linkTags: [],
  url: {
    jobs: {
      link: 'https://www.mercadolibre.com.ar/jobs',
      name: 'Trabaja con nosotros',
    },
    helpMain: {
      link: 'https://www.mercadolibre.com.ar/ayuda',
      name: 'Ayuda',
    },
  },
  mobileFooterLinks: [
    { link: 'myAccount' },
    { link: 'purchases' },
    { link: 'navigation' },
    { link: 'offers' },
    { link: 'bookmarks' },
    { link: 'officialStores' },
    { link: 'mobileCategories' },
    { link: 'loyalty' },
    { link: 'helpMain' },
    { link: 'sell' },
  ],
  desktopFooterLinks: ['jobs', 'tyc', 'politics', 'helpMain'],
  mobileSecondaryFooterLinks: [],
  sic: null,
  guestMobileFooterLinks: [
    { link: 'login' },
    { link: 'registration' },
  ],
  guestMobileFooterSecondaryLinks: [
    { link: 'politics' },
  ],
  kyc: null,
  skipToMainContent: null,
  mobileHeaderMenuIcons: {
    myAccount: 'nav-icon-my-account-mobile',
    notificationsCenter: 'nav-icon-notifications-mobile',
    bookmarks: 'nav-icon-bookmarks-mobile',
    supermercado: 'nav-icon-supermercado',
    credits: 'nav-icon-mercado-credits-mobile',
    registration: 'nav-icon-create-account-mobile',
    purchases: 'nav-icon-purchases-mobile',
    navigation: 'nav-icon-history-mobile',
    login: 'nav-icon-logout-mobile',
    mobileCategories: 'nav-icon-categories-mobile',
    officialStores: 'nav-icon-stores-mobile',
    discounts: 'nav-icon-points-discounts-mobile',
    offers: 'nav-icon-deals-mobile',
    sell: 'nav-icon-vender-mobile',
    helpMain: 'nav-icon-help-mobile',
    downloadAppStore: 'nav-icon-download-mobile',
    home: 'nav-icon-home',
  },
  uiNavigationVersion: '5.13.0',
  mobileHeaderMenuLinks: {
    logged: [
      ['home', 'notificationsCenter', 'navigation'],
    ],
    guest: [
      ['home', 'navigation'],
    ],
  },
  userMenuGuest: undefined,
  headerMenuLinks: [
    { link: 'cpLocation', isCP: true },
    { link: 'help' },
  ],
  copyrightSince: '1999',
  companyName: 'Mercado Libre',
  extraCompanyName: undefined,
  mobileAppsStore: {
    ios: 'https://itunes.apple.com/es/app/id463624852',
    android: 'https://play.google.com/store/apps/details?id=com.mercadolibre',
  },
};

const mockConfig = () => jest.doMock('ml-navigation-config', () => ({
  getValue: jest.fn().mockImplementation(({ key }) => {
    if (key in config) {
      return config[key];
    }

    throw new Error(`Unknown ml-navigation-config key ${key}`);
  }),
  getEnvironment: () => 'production',
  addUpdateHandler: () => {},
}));

describe('Mercado Libre Navigation', () => {
  beforeEach(() => jest.resetModules());

  it('matches the default snapshot for mobile version', () => {
    jest
      .useFakeTimers()
      .setSystemTime(new Date('2021-06-01').getTime());

    const renderer = new ShallowRenderer();

    mockConfig();

    const Navigation = require('./index');

    const component = (
      <Navigation
        {...baseProps}
      >
        <main role="main" id="root-app">{'{{children}}'}</main>
      </Navigation>
    );
    expect(renderer.render(component)).toMatchSnapshot();
  });

  it('matches the default snapshot when the type is hidden, returning only the children', () => {
    const renderer = new ShallowRenderer();

    mockConfig();

    const Navigation = require('./index');

    const component = (
      <Navigation
        {...baseProps}
        type="hidden"
      >
        <main role="main" id="root-app">{'{{children}}'}</main>
      </Navigation>
    );
    expect(renderer.render(component)).toMatchSnapshot();
  });

  it('matches the default snapshot for desktop version', () => {
    jest
      .useFakeTimers()
      .setSystemTime(new Date('2021-06-01').getTime());

    const renderer = new ShallowRenderer();

    mockConfig();

    const Navigation = require('./index');

    const component = (
      <Navigation
        {...baseProps}
        device={{
          ...baseProps.device,
          type: 'desktop',
          mobile: false,
          desktop: true,
        }}
      >
        <main role="main" id="root-app">{'{{children}}'}</main>
      </Navigation>
    );
    expect(renderer.render(component)).toMatchSnapshot();
  });

  it('matches the default snapshot for desktop version with a logged in user', () => {
    jest
      .useFakeTimers()
      .setSystemTime(new Date('2021-06-01').getTime());

    const renderer = new ShallowRenderer();

    const navigationPIIData = {
      preferredName: 'Test',
      email: 'test@test.com',
    };

    mockConfig();

    const Navigation = require('./index');

    const component = (
      <Navigation
        {...baseProps}
        device={{
          ...baseProps.device,
          type: 'desktop',
          mobile: false,
          desktop: true,
        }}
        user={{ nickname: 'test' }}
        navigationPIIData={navigationPIIData}
        userInfo={{ loyalty: { level: 1, percentage: 10 } }}
      >
        <main role="main" id="root-app">{'{{children}}'}</main>
      </Navigation>
    );
    expect(renderer.render(component)).toMatchSnapshot();
  });
});
