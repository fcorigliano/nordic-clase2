const statsd = require('frontend-statsd/internal');
const env = require('frontend-env');
const { baseKey } = require('./constants/statsd');

const send = (key, req, extraTags = {}) => {
  if (env.FURY && env.PRODUCTION) {
    const platformWithDefault = req.platform || {};
    const tags = {
      applicationId: env.APPLICATION || null,
      scopeId: env.SCOPE || null,
      platformId: platformWithDefault.id || null,
      siteId: platformWithDefault.siteId || null,
      domain: platformWithDefault.domain || null,
      ...extraTags,
    };
    statsd.histogram(`${baseKey}.${key}`, 1, tags);
  }
};

module.exports = {
  send,
};
