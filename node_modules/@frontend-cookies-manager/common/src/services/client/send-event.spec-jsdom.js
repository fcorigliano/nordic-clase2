const categories = {
  someCategoryName1: true,
  someCategoryName2: false,
};

describe('Send event client code', () => {
  let originalCustomEvent;

  beforeAll(() => {
    originalCustomEvent = window.CustomEvent;
  });

  beforeEach(() => {
    jest.resetModules();
  });

  it('should trigger event using provided CustomEvent', () => {
    window.CustomEvent = originalCustomEvent;

    const handler = jest.fn();
    document.addEventListener('cookiesConsentChange', handler);

    const sendEvent = require('./send-event');
    sendEvent(categories);

    expect(handler).toHaveBeenCalledWith(expect.objectContaining({
      detail: categories,
    }));
  });

  it('should trigger event using CustomEvent polyfill', () => {
    window.CustomEvent = null;

    const sendEvent = require('./send-event');

    const handler = jest.fn();
    document.addEventListener('cookiesConsentChange', handler);
    sendEvent(categories);

    expect(handler).toHaveBeenCalledWith(expect.objectContaining({
      detail: categories,
    }));
  });
});
