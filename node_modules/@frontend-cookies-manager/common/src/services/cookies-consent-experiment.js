const dpConfig = require('data-privacy-config');
const {
  consentBanner,
  selectedVariant,
} = require('../constants/configurations');
const { getDpEnvironment } = require('./get-dp-environment');

const selectedVariantKey = [
  consentBanner,
  selectedVariant,
].join('.');

const getRenderTypeExperimentConfig = ({
  platform,
  headers,
  cookies,
  req,
}) => {
  const {
    id: platformId,
    siteId,
  } = platform || {};

  const dpConfigEnvironment = getDpEnvironment({
    req,
    headers,
    cookies,
  });

  if (platformId && siteId) {
    const selectedVariantValue = dpConfig.getValue({
      key: selectedVariantKey,
      platform,
      environment: dpConfigEnvironment,
      req,
    });

    if (selectedVariantValue) {
      return selectedVariantValue;
    }
  }

  return null;
};

module.exports = {
  getRenderTypeExperimentConfig,
};
