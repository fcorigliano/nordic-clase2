const { readdirSync } = require('fs');
const { join } = require('path');

const cache = {};

const getData = (namespace) => {
  if (cache[namespace]) {
    return cache[namespace];
  }
  const entriesFolder = join(__dirname, '..', namespace, 'css', 'entries');
  const fileNames = readdirSync(entriesFolder, { withFileTypes: true })
    .filter((entry) => !entry.isDirectory())
    .map((entry) => entry.name);

  const data = fileNames.map((fileName) => {
    const withoutExtension = fileName.split('.')[0];
    const parts = withoutExtension.split('-');
    return {
      fileName,
      withoutExtension,
      platformId: parts[0].toUpperCase(),
      deviceType: parts[1],
    };
  });

  cache[namespace] = data;

  return data;
};

module.exports = {
  getData,
};
