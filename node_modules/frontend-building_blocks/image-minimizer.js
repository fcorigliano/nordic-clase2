const ImageMinimizerPlugin = require('image-minimizer-webpack-plugin');
const { extendDefaultPlugins } = require('svgo');

const imageMinimizerConfig = {
  severityError: 'warning',
  minimizerOptions: {
    plugins: [
      ['imagemin-svgo',
        {
          plugins: extendDefaultPlugins([
            { name: 'removeViewBox', active: false },
            { name: 'removeTitle', active: true },
            { name: 'removeDesc', active: true },
          ]),
        },
      ],
    ],
  },
};

function imageMinimizer(options = {}) {
  return (context) => ({
    module: {
      rules: [
        {
          test: /\.(|jpe?g|png|svg|)$/i,
          use: [
            {
              loader: ImageMinimizerPlugin.loader,
              options: {...imageMinimizerConfig, ...options},
            },
          ],
        },
      ],
    },
  });
}

module.exports = imageMinimizer;