/* eslint-disable security/detect-object-injection */
/**
 * Generic prepare to render for the API calls that each navigation needs to execute
 * @param {Array} services - list of key value objects where key is the
 * resulting key for the response that the service retrieved.
 * Example: [{ key: 'categories', execute: (props, req, res) => { ... } }]
 * @param {object} props - additional parameters calculated by frontend-layout
 * @param {object} req - express request
 * @param {object} res - express response
 */
const prepareToRender = (services, props, req, res) => {
  const servicesPromise = services.map(
    service => service.execute(req, res, props),
  );

  const prepareToRenderPromise =
    Promise.all(servicesPromise)
      .then((servicesResponses) => {
        const prepareToRenderResponse = services.reduce((response, service, index) => {
          const serviceResponse = servicesResponses[index];
          response[service.key] = serviceResponse;
          return response;
        }, props);

        return prepareToRenderResponse;
      });

  return prepareToRenderPromise;
};

module.exports = prepareToRender;
