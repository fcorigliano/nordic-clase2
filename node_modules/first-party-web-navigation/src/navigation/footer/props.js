const feConfig = require('frontend-config');
const { getValue } = require('first-party-navigation-config');

const getFooterTexts = (platformId, siteId, feConfigEnvironment) => {
  const currentYear = new Date().getFullYear();
  const companyName = feConfig.get('companyName', platformId, siteId, feConfigEnvironment);
  return {
    copyright: `Copyright Â© ${currentYear} ${companyName}`,
  };
};

const footerProps = (props) => {
  const {
    platform,
    feConfigEnvironment,
    req,
  } = props;

  const firstPartyConfig = getValue({
    key: 'firstParty',
    platform,
    req,
  });
  const isDesktop = props.device.desktop || false;
  if (!firstPartyConfig) return { isDesktop, links: null, texts: null };

  const feConfigUrls = feConfig.get('url', platform.id, platform.siteId, feConfigEnvironment);
  const fpConfigUrls = getValue({
    key: 'url',
    platform,
    req,
  });

  const { desktopFooterLinks } = firstPartyConfig;
  const links = desktopFooterLinks.map(link => fpConfigUrls[link] || feConfigUrls[link]); // eslint-disable-line security/detect-object-injection
  const texts = getFooterTexts(platform.id, platform.siteId, feConfigEnvironment);

  return {
    isDesktop,
    links,
    texts,
  };
};

module.exports = footerProps;
