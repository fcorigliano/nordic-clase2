const prepareToRender = require('@frontend-navigations/commons/prepare-to-render');

const baseProps = {
  platform: {
    siteId: 'CBT',
    countryId: 'US',
    id: 'ML',
    domain: 'global-selling.mercadolibre.com',
  },
  device: {
    type: 'desktop',
    mobile: false,
    tablet: false,
    desktop: true,
    forced: false,
    originalType: 'desktop',
  },
  cbt: {
    siteUsers: [
      {
        user_id: 463163127,
        site_id: 'MLA',
        status: 'active',
        enabled_sites: [
          'MLA',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
      {
        user_id: 463166651,
        site_id: 'MLB',
        status: 'active',
        enabled_sites: [
          'MLB',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
      {
        user_id: 463163332,
        site_id: 'MLM',
        status: 'active',
        enabled_sites: [
          'MLM',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
    ],
    siteUserId: 463163127,
    currentSiteId: 'MLA',
  },
  protocol: 'https',
  headers: {
    host: 'dev.global-selling.mercadolibre.com:8443',
  },
  url: '/',
};

const urls = {
  mainDomain: {
    name: '',
    link: 'global-selling.mercadolibre.com',
  },
  baseDomain: {
    name: '',
    link: '//global-selling.mercadolibre.com',
  },
  rootDomain: {
    name: '',
    link: 'https://www.mercadolibre.com/jms/cbt',
  },
  listing: {
    name: 'Listado',
  },
  buyingFlow: {
    name: '',
  },
  downloadAppLanding: {
    name: '¡Descarga gratis la app de Mercado&nbsp;Libre!',
  },
  downloadAppStore: {
    name: '¡Compra y vende con la app!',
  },
  institucional: {
    link: 'https://ideas.mercadolibre.com/ar/noticias/',
    name: 'Mercado Libre',
  },
  jobs: {
    link: 'http://www.mercadolibre.com/empleos',
    name: 'Trabaja con nosotros',
  },
  investor: {
    link: 'http://investor.mercadolibre.com',
    name: 'Investor relations',
  },
  developers: {
    link: 'http://developers.mercadolibre.com',
    name: 'Developers',
  },
  login: {
    name: 'Log in',
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/login',
  },
  logout: {
    name: 'Log out',
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/logout',
  },
  registration: {
    name: 'Crea tu cuenta',
  },
  notifications: {
    name: 'Notificaciones',
  },
  notificationsCenter: {
    name: 'Notificaciones',
  },
  mpago: {
    name: 'Mercado Pago',
  },
  mclics: {
    name: 'Mercado Libre Publicidad',
  },
  mshops: {
    name: 'Mercado Shops',
  },
  menvios: {
    name: 'Mercado Envíos',
  },
  mideas: {
    name: 'Mercado Libre Ideas',
  },
  trends: {
    name: 'Tendencias',
  },
  officialStores: {
    name: 'Tiendas oficiales',
  },
  loyalty: {
    name: 'Mercado Puntos',
  },
  credits: {
    name: 'Mercado Crédito',
  },
  home: {
    name: 'Inicio',
    link: 'https://global-selling.mercadolibre.com',
  },
  sitemap: {
    name: 'Mapa del sitio',
  },
  myAccount: {
    name: 'My account',
    link: 'https://global-selling.mercadolibre.com',
  },
  yourPurchases: {
    name: 'Tus compras',
  },
  purchases: {
    name: 'Compras',
  },
  yourNavigation: {
    name: 'Tu historial',
  },
  navigation: {
    name: 'Historial',
  },
  offers: {
    name: 'Ofertas de la semana',
  },
  bookmarks: {
    name: 'Favoritos',
  },
  categories: {
    name: 'Categorías',
  },
  mobileCategories: {
    name: 'Categorías',
  },
  mobileCPlocations: {
    name: 'Ingresa tu domicilio',
  },
  cpLocation: {
    name: 'Ingresa tu domicilio',
  },
  profile: {
    name: 'Perfil',
  },
  politics: {
    name: 'Políticas de privacidad',
    link: 'https://global-selling.mercadolibre.com',
  },
  tyc: {
    name: 'Términos y condiciones',
    link: 'https://global-selling.mercadolibre.com',
  },
  sell: {
    name: 'Vender',
  },
  syi: {
    name: 'Vender',
  },
  cart: {
    name: 'Carrito',
  },
  accountMoney: {
    name: 'Dinero en Mercado Pago',
  },
  discounts: {
    name: 'Descuentos exclusivos',
  },
  helpMain: {
    name: 'Help',
    link: 'https://global-selling.mercadolibre.com/help',
    icon: 'https://global-selling.mercadolibre.com/icon.png',
  },
  helpBuy: {
    name: 'Comprar',
  },
  helpSell: {
    name: 'Vender',
  },
  helpFreeSell: {
    name: 'Vende gratis',
  },
  helpContact: {
    name: 'Resolución de problemas',
  },
  helpShipping: {
    name: 'Cómo recibir el producto',
  },
  helpSecurity: {
    name: 'Centro de seguridad',
  },
  helpMpagoFaq: {
    name: 'Comprar con MercadoPago',
  },
  helpBpp: {
    name: 'Compra Protegida',
    link: 'https://portal-cbt.mercadolibre.com/faqs',
  },
  helpClaims: {
    name: 'Libro de reclamaciones',
  },
  twitter: {
    name: 'Twitter',
  },
  facebook: {
    name: 'Facebook',
  },
  instagram: {
    name: 'Instagram',
  },
  youtube: {
    name: 'YouTube',
  },
  supermercado: {
    name: 'Supermercado',
  },
  honeyPath: {
    link: 'https://hp.mercadolibre.com/',
    name: 'Mercado Libre',
  },
  changeNickName: {
    link: 'https://global-selling.mercadolibre.com',
  },
  about: {
    name: 'About selling globally',
    link: 'https://portal-cbt.mercadolibre.com/about',
  },
  publish: {
    name: 'Add listings',
    link: 'https://global-selling.mercadolibre.com/listings/bulk-listing/hub',
  },
  reauthentication: {
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/authentication',
  },
};

describe('Mercado Libre CBT User Menu Service', () => {
  it('returns correct props for CBT when CBTDetection is ON', async () => {
    const getValue = jest.fn().mockImplementation(({ key }) => {
      const hash = {
        url: urls,
        headerMenuLinks: [{
          link: 'publish',
        }, {
          link: 'helpMain',
        }],
      };

      return hash[key];
    });
    jest.doMock('cbt-navigation-config', () => ({ getValue }));

    const userMenuService = require('.');

    const services = [
      { key: 'userMenu', execute: userMenuService },
    ];
    const asyncPrepare = (props, req, res) => prepareToRender(services, props, req, res);
    const result = await asyncPrepare({}, baseProps, {});
    expect(result).toEqual(
      {
        userMenu: {
          links: {
            myAccount: {
              name: 'My account',
              link: 'https://global-selling.mercadolibre.com',
            },
            login: {
              name: 'Log in',
              link: 'https://www.mercadolibre.com/jms/cbt/lgz/login?go=https%3A%2F%2Fdev.global-selling.mercadolibre.com%3A8443%2F',
            },
            logout: {
              name: 'Log out',
              link: 'https://www.mercadolibre.com/jms/cbt/lgz/logout?go=https%3A%2F%2Fdev.global-selling.mercadolibre.com%3A8443%2F',
            },
          },
          sites: {
            MLA: {
              text: 'Argentina',
              countryId: 'AR',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Argentina.svg',
            },
            MLM: {
              text: 'Mexico',
              countryId: 'MX',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Mexico.svg',
            },
            MLB: {
              text: 'Brazil',
              countryId: 'BR',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Brazil.svg',
            },
            MCO: {
              text: 'Colombia',
              countryId: 'CO',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Colombia.svg',
            },
            MLC: {
              text: 'Chile',
              countryId: 'CL',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Chile.svg',
            },
            MLV: {
              text: 'Venezuela',
              countryId: 'VE',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Venezuela.svg',
            },
            MSV: {
              text: 'El Salvador',
              countryId: 'SV',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Salvador.svg',
            },
            MNI: {
              text: 'Nicaragua',
              countryId: 'NI',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Nicaragua.svg',
            },
            MGT: {
              text: 'Guatemala',
              countryId: 'GT',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Guatemala.svg',
            },
            MEC: {
              text: 'Ecuador',
              countryId: 'EC',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Ecuador.svg',
            },
            MHN: {
              text: 'Honduras',
              countryId: 'HN',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Honduras.svg',
            },
            MPE: {
              text: 'Peru',
              countryId: 'PE',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Peru.svg',
            },
            MLU: {
              text: 'Uruguay',
              countryId: 'UY',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Uruguay.svg',
            },
            MRD: {
              text: 'República Dominicana',
              countryId: 'DO',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Dominicana.svg',
            },
            MCR: {
              text: 'Costa Rica',
              countryId: 'CR',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/CostaRica.svg',
            },
            MBO: {
              text: 'Bolivia',
              countryId: 'BO',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Bolivia.svg',
            },
            MPA: {
              text: 'Panamá',
              countryId: 'PA',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Panama.svg',
            },
            MPY: {
              text: 'Paraguay',
              countryId: 'PY',
              flag: 'https://http2.mlstatic.com/storage/cbt-statics/layout/header/flags/Paraguay.svg',
            },
          },
          logisticTypes: {
            remote: '',
            '3pl': '(Warehouse)',
            fulfillment: '(Full)',
          },
          loggedLinks: [
            {
              link: 'https://global-selling.mercadolibre.com/listings/bulk-listing/hub',
              name: 'Add listings',
              id: 'publish',
            },
          ],
          icons: [
            {
              icon: 'https://global-selling.mercadolibre.com/icon.png',
              link: 'https://global-selling.mercadolibre.com/help',
              name: 'Help',
              id: 'helpMain',
            },
          ],
          cbtInfo: {
            siteUsers: [
              {
                user_id: 463163127,
                site_id: 'MLA',
                status: 'active',
                enabled_sites: [
                  'MLA',
                ],
                parent_id: 462143006,
                logistic_type: 'remote',
                site_users: null,
              },
              {
                user_id: 463166651,
                site_id: 'MLB',
                status: 'active',
                enabled_sites: [
                  'MLB',
                ],
                parent_id: 462143006,
                logistic_type: 'remote',
                site_users: null,
              },
              {
                user_id: 463163332,
                site_id: 'MLM',
                status: 'active',
                enabled_sites: [
                  'MLM',
                ],
                parent_id: 462143006,
                logistic_type: 'remote',
                site_users: null,
              },
            ],
            siteUserId: 463163127,
            currentSiteId: 'MLA',
          },
        },
      },
    );
  });
});
