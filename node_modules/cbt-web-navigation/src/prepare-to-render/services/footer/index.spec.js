const prepareToRender = require('@frontend-navigations/commons/prepare-to-render');

const urls = {
  mainDomain: {
    name: '',
    link: 'global-selling.mercadolibre.com',
  },
  baseDomain: {
    name: '',
    link: '//global-selling.mercadolibre.com',
  },
  rootDomain: {
    name: '',
    link: 'https://www.mercadolibre.com/jms/cbt',
  },
  listing: {
    name: 'Listado',
  },
  buyingFlow: {
    name: '',
  },
  downloadAppLanding: {
    name: '¡Descarga gratis la app de Mercado&nbsp;Libre!',
  },
  downloadAppStore: {
    name: '¡Compra y vende con la app!',
  },
  institucional: {
    link: 'https://ideas.mercadolibre.com/ar/noticias/',
    name: 'Mercado Libre',
  },
  jobs: {
    link: 'http://www.mercadolibre.com/empleos',
    name: 'Trabaja con nosotros',
  },
  investor: {
    link: 'http://investor.mercadolibre.com',
    name: 'Investor relations',
  },
  developers: {
    link: 'http://developers.mercadolibre.com',
    name: 'Developers',
  },
  login: {
    name: 'Log in',
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/login',
  },
  logout: {
    name: 'Log out',
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/logout',
  },
  registration: {
    name: 'Crea tu cuenta',
  },
  notifications: {
    name: 'Notificaciones',
  },
  notificationsCenter: {
    name: 'Notificaciones',
  },
  mpago: {
    name: 'Mercado Pago',
  },
  mclics: {
    name: 'Mercado Libre Publicidad',
  },
  mshops: {
    name: 'Mercado Shops',
  },
  menvios: {
    name: 'Mercado Envíos',
  },
  mideas: {
    name: 'Mercado Libre Ideas',
  },
  trends: {
    name: 'Tendencias',
  },
  officialStores: {
    name: 'Tiendas oficiales',
  },
  loyalty: {
    name: 'Mercado Puntos',
  },
  credits: {
    name: 'Mercado Crédito',
  },
  home: {
    name: 'Inicio',
    link: 'https://global-selling.mercadolibre.com',
  },
  sitemap: {
    name: 'Mapa del sitio',
  },
  myAccount: {
    name: 'My account',
    link: 'https://global-selling.mercadolibre.com',
  },
  yourPurchases: {
    name: 'Tus compras',
  },
  purchases: {
    name: 'Compras',
  },
  yourNavigation: {
    name: 'Tu historial',
  },
  navigation: {
    name: 'Historial',
  },
  offers: {
    name: 'Ofertas de la semana',
  },
  bookmarks: {
    name: 'Favoritos',
  },
  categories: {
    name: 'Categorías',
  },
  mobileCategories: {
    name: 'Categorías',
  },
  mobileCPlocations: {
    name: 'Ingresa tu domicilio',
  },
  cpLocation: {
    name: 'Ingresa tu domicilio',
  },
  profile: {
    name: 'Perfil',
  },
  politics: {
    name: 'Políticas de privacidad',
    link: 'https://global-selling.mercadolibre.com',
  },
  tyc: {
    name: 'Términos y condiciones',
    link: 'https://global-selling.mercadolibre.com',
  },
  sell: {
    name: 'Vender',
  },
  syi: {
    name: 'Vender',
  },
  cart: {
    name: 'Carrito',
  },
  accountMoney: {
    name: 'Dinero en Mercado Pago',
  },
  discounts: {
    name: 'Descuentos exclusivos',
  },
  helpMain: {
    name: 'Help',
    link: 'https://global-selling.mercadolibre.com/help',
    icon: 'https://global-selling.mercadolibre.com/icon.png',
  },
  helpBuy: {
    name: 'Comprar',
  },
  helpSell: {
    name: 'Vender',
  },
  helpFreeSell: {
    name: 'Vende gratis',
  },
  helpContact: {
    name: 'Resolución de problemas',
  },
  helpShipping: {
    name: 'Cómo recibir el producto',
  },
  helpSecurity: {
    name: 'Centro de seguridad',
  },
  helpMpagoFaq: {
    name: 'Comprar con MercadoPago',
  },
  helpBpp: {
    name: 'Compra Protegida',
    link: 'https://portal-cbt.mercadolibre.com/faqs',
  },
  helpClaims: {
    name: 'Libro de reclamaciones',
  },
  twitter: {
    name: 'Twitter',
  },
  facebook: {
    name: 'Facebook',
  },
  instagram: {
    name: 'Instagram',
  },
  youtube: {
    name: 'YouTube',
  },
  supermercado: {
    name: 'Supermercado',
  },
  honeyPath: {
    link: 'https://hp.mercadolibre.com/',
    name: 'Mercado Libre',
  },
  changeNickName: {
    link: 'https://global-selling.mercadolibre.com',
  },
  about: {
    name: 'About selling globally',
    link: 'https://portal-cbt.mercadolibre.com/about',
  },
  publish: {
    name: 'Add listings',
    link: 'https://global-selling.mercadolibre.com/listings/bulk-listing/hub',
  },
  reauthentication: {
    link: 'https://www.mercadolibre.com/jms/cbt/lgz/authentication',
  },
};

const baseProps = {
  platform: {
    siteId: 'CBT',
    countryId: 'US',
    id: 'ML',
    domain: 'global-selling.mercadolibre.com',
  },
  device: {
    type: 'desktop',
    mobile: false,
    tablet: false,
    desktop: true,
    forced: false,
    originalType: 'desktop',
  },
  cbt: {
    siteUsers: [
      {
        user_id: 463163127,
        site_id: 'MLA',
        status: 'active',
        enabled_sites: [
          'MLA',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
      {
        user_id: 463166651,
        site_id: 'MLB',
        status: 'active',
        enabled_sites: [
          'MLB',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
      {
        user_id: 463163332,
        site_id: 'MLM',
        status: 'active',
        enabled_sites: [
          'MLM',
        ],
        parent_id: 462143006,
        logistic_type: 'remote',
        site_users: null,
      },
    ],
    siteUserId: 463163127,
    currentSiteId: 'MLA',
  },
  protocol: 'https',
  headers: {
    host: 'dev.global-selling.mercadolibre.com:8443',
  },
  url: '/',
};

describe('Mercado Libre CBT Footer Service', () => {
  beforeEach(() => jest.resetModules());

  it('returns correct footer props for CBT', async () => {
    jest.doMock('cbt-navigation-config', () => ({
      getValue: jest.fn().mockImplementation(({ key }) => {
        const hash = {
          url: urls,
          desktopFooterLinks: ['investor', 'about', 'helpMain'],
        };

        return hash[key];
      }),
    }));

    jest.doMock('frontend-config', () => ({
      get: jest.fn().mockReturnValue('MercadoLibre S.R.L.'),
    }));

    const footerService = require('.');
    const services = [
      { key: 'footer', execute: footerService },
    ];
    const asyncPrepare = (props, req, res) => prepareToRender(services, props, req, res);
    const result = await asyncPrepare({}, baseProps, {});
    const currentYear = new Date().getFullYear();
    expect(result).toEqual(
      {
        footer: {
          links: [
            {
              link: 'http://investor.mercadolibre.com',
              name: 'Investor relations',
            },
            {
              name: 'About selling globally',
              link: 'https://portal-cbt.mercadolibre.com/about',
            },
            {
              name: 'Help',
              link: 'https://global-selling.mercadolibre.com/help',
              icon: 'https://global-selling.mercadolibre.com/icon.png',
            },
          ],
          texts: {
            copyright: `Copyright © ${currentYear} MercadoLibre S.R.L.`,
          },
          platformId: 'ML',
          siteId: 'CBT',
          isDesktop: true,
        },
      },
    );
  });
});
