const script = require('./site-switcher');

describe('CBT Navigation', () => {
  describe('Site Switcher Script', () => {
    beforeEach(() => {
      global.document = {};
      global.currentSite = 'MLM-remote';
      global.location = { reload: jest.fn() };
    });

    it('should update the cookie', () => {
      let i = 0;
      const event = { target: { dataset: { value: 'MLM-fulfillment' } } };
      const listeners = [
        { addEventListener: jest.fn((type, listener) => { listener(event); }) },
        { addEventListener: jest.fn() },
      ];
      const document = {
        cookie: '',
        querySelector: jest.fn(() => {
          const listener = listeners[i];
          i += 1;
          return listener;
        }),
      };
      global.document = document;
      const currentSite = 'MLM-remote';
      script(currentSite);
      expect(document.cookie).toBe('cbtSiteId=MLM-fulfillment; path=/;');
    });

    it('should clear the cookie', () => {
      let i = 0;
      const listeners = [
        { addEventListener: jest.fn() },
        { addEventListener: jest.fn((type, listener) => { listener(); }) },
      ];
      const document = {
        cookie: 'cbtSiteId=MLM-fulfillment; path=/;',
        querySelector: jest.fn(() => {
          const listener = listeners[i];
          i += 1;
          return listener;
        }),
      };
      global.document = document;
      const currentSite = 'MLM-remote';
      script(currentSite);
      expect(document.cookie).toBe('cbtSiteId=; expires = Thu, 01 Jan 1970 00:00:00 GMT; path=/;');
    });
  });
});
