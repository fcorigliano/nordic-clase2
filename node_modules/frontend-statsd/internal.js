/**
 * Module dependencies
 */
const StatsD = require('hot-shots');
const logger = require('frontend-logger')('statsd-internal-client');
const env = require('frontend-env');
const { host, maxBufferSize } = require('./src/defaultConfig');

const mock = !env.FURY || env.IS_CI;

/* istanbul ignore next */
const defaultErrorHandler = (error) => {
  /**
   * Catch socket errors so they don't go unhandled
   */
  const errorDetail = error ? (`: ${error.stack}`) : '';
  logger.warn(`Error in internal client StatsD socket${errorDetail}`);
};

/**
 * Create a new StatsD internal client
 */
const statsdInternalClient = new StatsD({
  host,
  maxBufferSize,
  prefix: '',
  suffix: '',
  mock,
  errorHandler: !mock ? defaultErrorHandler : null,
});

/**
 * Expose StatsD internal client
 */
module.exports = statsdInternalClient;
