const withSideEffect = require('react-side-effect');

const PropTypes = require('prop-types');

const GTM = require('./GTM');

GTM.propTypes = {
  id: PropTypes.string,
  dataLayer: PropTypes.arrayOf(PropTypes.object),
  disabled: PropTypes.bool
};

function reducePropsToState(propsList) {
  const props = {};
  propsList.forEach(currentProps => {
    Object.keys(currentProps).forEach(p => {
      if (Array.isArray(props[p]) && Array.isArray(currentProps[p])) {
        props[p] = props[p].concat(currentProps[p]);
      } else {
        props[p] = currentProps[p];
      }
    });
  });
  return props;
}

function handleStateChangeOnClient() {
  // Do nothing for now
  return null;
}

function mapStateOnServer(props) {
  return props;
}

module.exports = withSideEffect(reducePropsToState, handleStateChangeOnClient, mapStateOnServer)(GTM);