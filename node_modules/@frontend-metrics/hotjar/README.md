# Frontend Hotjar

> Mercado Libre Node.js adapter for [Hotjar](https://www.hotjar.com/)

The main goal of this module is to build a platform and site dependent tracking code optimized for performance.

_Note_: For any additional information about Hotjar please see
[the official docs](https://docs.hotjar.com/docs).

> Important: Please fill up [this form](https://bit.ly/AccessHJ) to request access to _Mercado Libre Hotjar's Dashboard_. In case you need assistance, you can reach out to the Slack Channel [#team-ur-data-tools](https://meli.slack.com/archives/C01BK8ZBG75) or via email to either **Alan Matias Gregorio** or **Melisa Chetto**.

## Installation

```bash
npm install @frontend-metrics/hotjar
```

## Usage

To use it within Nordic simply require the component and use it in your view with the [options](#options) you need:

```jsx
const Hotjar = require('@frontend-metrics/hotjar');

const DemoView = (props) => (
  <div>
    <Hotjar
      tagPrefix={'my-prefix-'}
      tags={['typification: broken_item']}
      triggers={['launch-poll']}
    />
  </div>
);
```

You can also specify those [options](#options) in your config file under a siteId (MLA, MLB, etc.) or platformId (ML, MP, etc.):

```js
// ./config/default.json
{
  ML: {
    hotjar: { /* you'll use this config if no siteId has hotjar specified */
      tagPrefix: 'myMLprefix-'
    }
    MLA: {
      hotjar: { /* you'll use this config when the user is on MLA */
        tagPrefix: 'myMLAprefix-'
      }
    }
  }
}
```

_Note:_ The Component options take higher precedence than that of the configuration file. E.g: In the previous example, the `tagPrefix` would always be `my-prefix-`.

**Warning**: It's discouraged to specify a custom `id`, please read [this section for more informacion](#Important-About-hotjar-ID)

### Running Hotjar in Debug Mode

We can make Hotjar to work in **Debug Mode** by any of these:

- Adding the `X-Hotjar-Debug` header on the HTTP request. You can use tools such as [ModHeader](https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=en) for this
- Adding the `hotjar_debug` query parameter on the URL, for example: `https://www.mercadolibre.com.ar/?hotjar_debug`

During _Debug Mode_ the `traffic` property is set to 100% ({ from: 0, to: 99 }) and will allow Hotjar to output logs into the browser's console. With those logs you can check Hotjar is using the options you desired.

## Options

You can specify them through props or in your config file.

- `id`: `optional` - The Hotjar script ID (see [important note below](#important-about-hotjar-id-and-traffic) regarding this).
- `tags`: `optional` - An array of keywords used to tag recordings. You can freely choose the ones that you think will help you find the recordings more easily.
- `tagPrefix`: `optional` - A string used to prefix tags.
- `triggers`: `optional` - An array of strings to execute (trigger) Hotjar features.
- `disabled`: `optional` - A boolean indicating if Hotjar should be disabled.
- `traffic`: `optional` - An object indicating the traffic sent to Hotjar Servers. Format: `{from: 0, to: 99}` (see [important note below](#important-about-hotjar-id-and-traffic) regarding this).

- This plugin will automagically add the following tags:
  - `user_type` - Possible values are: `test`|`normal`. Example: `user_type: test`.
  - `app` - The APP name, obtained from `process.env.APPLICATION` if available. Example: `app: returns-frontend`.

## Important: About hotjar ID and Traffic

- The Hotjar script ID and the traffic configuration is obtained from `frontend-config` based on `siteId` and `platformId`, but you're allowed to add your own if the User Research Team asks you to.

## Migration Guide

Before creating this component there were 3 ways to include Hotjar in applications, with its own component or through the deprecated version of frontend-metrics or frontend-hotjar

### With its own component

1. Detect the views where you were importing it.
2. Import the new component following the steps detailed in the [Usage](#Usage) section.
3. Do a search for the word hotjar in the configuration files located in the `./config` folder of the application.
4. If you find occurrences:
   - make sure that the properties set respect the signature defined in [Options](#options).
   - if the `id` or `traffic` property is defined, delete it, unless the User Research team explicitly requests it.
   - Make sure the hotjar config isn't inside the `metrics` key, your config should look something like what was shown in [Usage](#Usage)
5. Verify the operation. You can use [debug mode](#running-hotjar-in-debug-mode).
6. If everything works fine, you can delete the component itself and import it into the views that used it.

### With the deprecated version of [frontend-hotjar](https://github.com/mercadolibre/frontend-metrics/tree/master/packages/hotjar)

1. Update the old implementation by following the same steps as the previous section: [With its own component](#with-its-own-component)
2. Remove the dependency `frontend-hotjar`
3. If it exists in package.json, remove the `frontend-metrics` dependency as well.

### Via configuration with the deprecated version of [frontend-metrics](https://github.com/mercadolibre/frontend-metrics/tree/master/packages/metrics)

1. This option was turned on through the application settings, meaning, even when applications did not require the component, hotjar would be turned on if the setting was found. Such functionality was removed on this new plugin. Look in the json files located in `./config` if you have the `metrics` property. You should see something like the following:

   ```json
   {
     metrics: {
       hotjar: {
         id: 112233,
         traffic: {
           from: 0,
           to: 99,
         },
       },
     },
   },
   ```

2. Delete all the occurrences you find of this property.

## Internal Development

For more information about how this module works please read `@frontend-metrics/core` README.
