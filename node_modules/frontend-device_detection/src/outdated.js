/**
 * Module dependencies
 */
const { outdatedSupport } = require('./regexp');

/**
 * Use nginx headers in production to check is the device outdated.
 * @returns Boolean
 */
const getByHeader = (headers = {}) => headers['x-device-outdated'] === 'true';

/**
 * Use user-agent in development environment to check is the device outdated.
 * @returns Boolean
 */
const getByUserAgent = (lowEnd, ua = '') => lowEnd || outdatedSupport.test(ua);

/**
 * Exports module
 */
if (process.env.NODE_ENV === 'production') {
  // Exports for production, getting the result from headers only
  module.exports = headers => getByHeader(headers);
} else {
  // Exports for development and testing, getting the result from headers
  exports = module.exports = (headers, lowEnd) => getByUserAgent(lowEnd, headers['user-agent']); // eslint-disable-line no-multi-assign
  exports.getByHeader = getByHeader;
  exports.getByUserAgent = getByUserAgent;
}
