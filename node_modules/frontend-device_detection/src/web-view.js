/**
 * Exports module to analyze the user agent to determine if the device is inside a Web View
 * @returns object
 */

const regexp = require('./regexp');

const androidNoPS = 'AndroidNoPS';
const smartPOS = 'SmartPOS';

module.exports = (uaHeader, webkitLandingHeader) => {
  const nativeAppData = regexp.nativeApp.exec(uaHeader);
  return nativeAppData ? {
    webView: true,
    nativeWebview: webkitLandingHeader === 'true',
    nativeApp: {
      name: nativeAppData[2] === smartPOS ? smartPOS : nativeAppData[1],
      os: nativeAppData[2] === smartPOS ? 'Android' : nativeAppData[2].replace(androidNoPS, 'Android'),
      version: nativeAppData[3],
      googlePlayServices: ![androidNoPS, smartPOS].includes(nativeAppData[2]),
    },
  }
    : {
      webView: false,
      nativeWebview: false,
    };
};
