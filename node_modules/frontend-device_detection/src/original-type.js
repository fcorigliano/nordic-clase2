/**
 * Module dependencies
 */
const regexp = require('./regexp');
const isWebView = require('./web-view');

/**
 * Uses nginx headers to check for device type in production.
 * @returns Boolean
 */
const getByHeader = (headers = {}) => headers['x-device-type'] || 'desktop';

/**
 * Uses user agent to check for device type in development.
 * @returns Boolean
 */
const getByUserAgent = (headers = {}) => {
  const header = headers['user-agent'];
  if (regexp.mobile.test(header) || isWebView(header).webView) { return 'mobile'; }
  if (regexp.tablet.test(header)) { return 'tablet'; }
  return 'desktop';
};

/**
 * Exports module
 */
if (process.env.NODE_ENV === 'production') {
  // Exports for production, getting the result from headers
  module.exports = headers => getByHeader(headers);
} else {
  // Exports for development and testing, getting the result from cookies/headers
  exports = module.exports = headers => getByUserAgent(headers); // eslint-disable-line no-multi-assign
  exports.getByHeader = getByHeader;
  exports.getByUserAgent = getByUserAgent;
}
