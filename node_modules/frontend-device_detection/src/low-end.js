/**
 * Module dependencies
 */
const regexp = require('./regexp');

/**
 * Uses nginx headers to check for low-end device in production.
 * @returns Boolean
 */
const getByHeader = (headers = {}) => (
  headers['x-device-lowend'] === 'true' || headers['x-device-js'] === 'false'
);

/**
 * Uses cookies (or user agent) to check for low-end device in development.
 * @returns Boolean
 */
const getByCookie = (headers = {}, cookies = {}) => {
  const cookie = cookies.device_noscript;
  const lowEndByCookie = cookie ? cookie === '1' : false;
  // By cookie or by user agent
  return lowEndByCookie || regexp.lowEnd.test(headers['user-agent']);
};

/**
 * Exports module
 */
if (process.env.NODE_ENV === 'production') {
  // Exports for production, getting the result from headers
  module.exports = headers => getByHeader(headers);
} else {
  // Exports for development and testing, getting the result from cookies/headers
  exports = module.exports = (headers, cookies) => getByCookie(headers, cookies); // eslint-disable-line no-multi-assign
  exports.getByHeader = getByHeader;
  exports.getByCookie = getByCookie;
}
