/**
 * Module dependencies
 */
const { sameSiteSupport } = require('./regexp');

/**
 * Use nginx headers to check is the device supports SameSite cookie.
 * @returns Boolean
 */
const getByHeader = (headers = {}) => headers['x-samesite-support'] !== 'false';

/**
 * Use user-agent in development environment to check is the device supports SameSite cookie.
 * @returns Boolean
 */
const getByUserAgent = (ua = '') => !sameSiteSupport.test(ua);

/**
 * Exports module
 */
if (process.env.NODE_ENV === 'production') {
  // Exports for production, getting the result from headers only
  module.exports = headers => getByHeader(headers);
} else {
  // Exports for development and testing, getting the result from headers
  exports = module.exports = headers => getByUserAgent(headers['user-agent']); // eslint-disable-line no-multi-assign
  exports.getByHeader = getByHeader;
  exports.getByUserAgent = getByUserAgent;
}
