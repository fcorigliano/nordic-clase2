const { A_DAY } = require('../constants/intervals');
const { TRACEABILITY, SEPARATOR } = require('../constants/properties-traceability');

const sendUsedKeys = ({ keysSet, logger }) => {
  setTimeout(function send() {
    if (keysSet.size) {
      Array.from(keysSet).forEach((usedKey) => {
        const [platformId, siteId, configKey] = usedKey.split(SEPARATOR);
        logger.info({
          statName: TRACEABILITY,
          extraTags: {
            platformId: platformId || null,
            siteId: siteId || null,
            configKey,
          },
        });
      });
      keysSet.clear();
    }
    setTimeout(send, A_DAY);
  }, A_DAY);
};

module.exports = sendUsedKeys;
