const { production } = require('../constants/environment-variables');

/**
 * Return the environment selected for use following this steps:
 * 1.- Check if environment its setted on req object and environmentHeader
 * 2.- Else, check if a environment string is passed
 * 3.- Else, return "production"
 *
 * @param {object} params - Used to evaluate environment (optional)
 * @param {object} params.req - Request object containing cookies and headers
 * @param {string} params.environment - Environment needed to fetch config data
 * @param {string} params.environmentHeader - Name of header used to select a test-environment
 * @returns {string} - Selected environment
 */
const getEnvironment = ({
  req,
  environment,
  environmentHeader,
}) => {
  const headersConfigEnvironment = environmentHeader && req && req.cookies && req.headers && req.cookies.meliLab
    && req.headers[environmentHeader] ? req.headers[environmentHeader] : null;
  return headersConfigEnvironment || environment || production;
};

module.exports = getEnvironment;
