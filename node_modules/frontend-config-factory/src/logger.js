const loggerFactory = require('frontend-logger');
const statsdInternal = require('frontend-statsd/internal');
const { STATS_PREFIX } = require('./constants/stats');

module.exports = (modulePackage) => {
  const logger = loggerFactory(modulePackage.name);

  // Error log
  const error = ({ log = false, ...options }) => {
    if (log) {
      logger.error(options.message);
    }
    if (options.statName) {
      const statsTags = {
        packageName: modulePackage.name,
        ...options.extraTags,
      };
      statsdInternal.histogram(`${STATS_PREFIX}.${options.statName}`, 1, statsTags);
    }
  };

  // Info log
  const info = ({ log = false, ...options }) => {
    if (log) {
      logger.info(options.message);
    }
    if (options.statName) {
      const statsTags = {
        packageName: modulePackage.name,
        ...options.extraTags,
      };
      statsdInternal.histogram(`${STATS_PREFIX}.${options.statName}`, 1, statsTags);
    }
  };

  return {
    error,
    info,
  };
};
