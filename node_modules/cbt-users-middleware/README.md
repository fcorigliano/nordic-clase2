# CBT users middleware

Middleware to handle CBT users relationship with their site users.

## Usage

1. Install dependency
   `npm i cbt-users-middleware`

2. Require and add middleware before auth.
```
/**
 * Module dependencies
 */
const router = require('ragnar').router();
const authorization = require('nordic/auth');
const cbtUsersMiddleware = require('cbt-users-middleware');

/**
 * Default authorization strategy
 */
const defaultAuthorize = authorization();

router.get('/default', defaultAuthorize, cbtUsersMiddleware, function (req, res) {
});

/**
 * Expose router
 */
module.exports = router;
```

3. Replace **req.user.id** with **req.customUserId**.


## API

### req.cbt

The middleware sets **req.cbt** with the information related to CBT.

#### req.cbt.siteUserId (number)
The id of the site related user.

```js
console.log(req.cbt.siteUserId) // 215516399
```

#### req.cbt.currentSiteId (string)
The site id of the current site view.

```js
console.log(req.cbt.currentSiteId) // 'MLA'
```

#### req.cbt.siteUsers (array)
Array with related site users (see [CBT users API](http://api.internal.ml.com/cbt/users/462143006?caller.scope=admin)).

```js
console.log(req.cbt.siteUsers) // []
```
