const { trackMetric } = require('../collector');
const { supportsFetchApi } = require('../support');
const { getWithFetch } = require('../utils/send');
const { X_CDN } = require('../../constants/metrics');

const xCDN = {
  g: 'google',
  a: 'akamai',
};

const pixelInformationMonitor = () => {
  if (!supportsFetchApi()) {
    return null;
  }
  return getWithFetch('https://http2.mlstatic.com/cdn/ping.gif')
    .then((res) => {
      if (res.headers.has('x-cdn')) {
        const cdn = res.headers.get('x-cdn');
        trackMetric(X_CDN, xCDN[cdn]);
      }
    })
    .catch(error => error);
};

module.exports = pixelInformationMonitor;
