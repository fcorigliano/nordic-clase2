# perfill-agent

# Table of Contents
- [Description](#description)
- [Usage](#usage)
- [Install](#install)
- [Example](#example)
- [Development](#development)
- [Tests](#tests)
- [Contributing](#contributing)
- [Changelog](#changelog)

## Description

- Perfill agent send performance metrics to [Insights metric collector](https://github.com/mercadolibre/fury_insights-metric-collector).
- Traffic Control handles when the agent should render.
- Agent Loader render a snippet code as google analytics.
- This agent controlled in frontend-layout and loaded transparently for all frontend

## Usage

### Install
```
npm install --save perfill-agent
```

### Example

#### Traffic Control
```js
const perfill = trafficControl(req, res);
```
Returns
```js
{
    application: 'app-demo',
    platform: 'ml',
    site: 'mla',
    device: 'desktop',
    initiatives: [{id: 'web-vitals'}],
}
```

#### Agent loader
```js
{ perfill && <Script>{agentLoader(perfill)}</Script> }
```
Render:
```js
<script>
    (function (w, p) {
      w[p] = w[p] || function () {
        (w[p].q = w[p].q || []).push(arguments)
      };
      w[p].l = 1 * new Date();
    }(window, "_perfill"));

    _perfill('set', 'platform', 'ml');
    _perfill('set', 'site', 'mla');
    _perfill('set', 'device', 'desktop');
    _perfill('set', 'application', 'app-demo');
    _perfill('set', 'initiatives', [{"id":"web-vitals"}]);
    _perfill('send', 'start');

    (function (d, s, f, t, x) {
      t = d.createElement(s);
      x = d.getElementsByTagName(s)[0];
      t.async = 1;
      t.src = f;
      x.parentNode.insertBefore(t, x);
    }(document, 'script', 'https://http2.mlstatic.com/frontend-assets/perfill-agent/0.0.3/perfill-agent.min.js'))
</script>
```


### Development

1) Install dependencies:

```
npm install
```

2) Build the component:

```
npm run build
```

3) Build the example app:

```
npm run build:examples
```

4) Run the example app:

```
npm run start-dev
npm run watch:examples // In case you want to watch your changes
```

5) Navigate to:

```
http://dev.mercadolibre.com.ar:8080/
```

### Tests
```npm
npm test
```

## Contributing

In order to contribute to this library, you must read [this guide](CONTRIBUTING.md) first.

## Changelog

We keep changes to our codebase [here](CHANGELOG.md)
