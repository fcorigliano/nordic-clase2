const env = require('frontend-env');
const config = require('../config');

const isFromShops = require('./is-from-shops');

const getProductionUrl = (req) => req.query?.ms_store ?? req.hostname;

const getDevelopmentUrl = (req) => {
  const domainOverride = config.features.fetchShopData.devShopDomain
    || req.cookies?.domain_override
    || req.query.domain_override;

  if (!domainOverride && isFromShops(req)) {
    throw new Error('domain_override query param must be defined in order to run app locally for mshops platform');
  }
  return domainOverride;
};

/**
 * Grabs the hostname from request
 * for develop environments, domain_override query param is used to get the url
 * @param {express.request} req
 */
module.exports = req => (env.DEVELOPMENT ? getDevelopmentUrl(req) : getProductionUrl(req));
