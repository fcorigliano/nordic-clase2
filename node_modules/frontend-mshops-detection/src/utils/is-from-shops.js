/* eslint-disable security/detect-object-injection */
const env = require('frontend-env');
const config = require('../config');

const HEADER_KEY = 'X-Mshops';
const COOKIE_KEY = 'x_mshops';
const EXPECTED_VALUE = '1';

const checkHeader = request => (request.headers && (request.header(HEADER_KEY) === EXPECTED_VALUE));
const checkCookie = request => (request.cookies && (request.cookies[COOKIE_KEY] === EXPECTED_VALUE));
const checkDevEnv = () => env.DEVELOPMENT && config.features.fetchShopData.devShopDomain;

/**
 * Detects if a request belongs to Mercado Shops.
 * @param {express.request} req
 */
module.exports = req => (checkHeader(req) || checkCookie(req)) || checkDevEnv();
