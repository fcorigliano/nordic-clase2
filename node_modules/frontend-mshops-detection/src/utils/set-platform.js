/**
 * Modules dependencies
 */
const logger = require('frontend-logger')('frontend-mshops-detection/set-platform');

/**
 * Sets the req.platform
 * @param {express.request} req
 * @param {Object} frontendWrapper the data returned by frontend wrapper service
 * @param {Object} frontendWrapper.shop the data of the shop per se
 */
module.exports = (req, frontendWrapper) => {
  if (!frontendWrapper || !frontendWrapper.shop) {
    logger.error(`The "req.platform" could not be set for the hostname ${req.hostname}`, {
      service: 'utils/set-platform',
    });
  }
  const shop = frontendWrapper?.shop;

  // Set defaults as null
  const {
    site_id: siteId = null,
    country_id: countryId = null,
    domain = null,
  } = shop || {};

  req.platform = {
    id: 'MS',
    siteId,
    countryId,
    domain,
    ...shop && { shop },
  };
};
