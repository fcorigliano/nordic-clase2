{
  "shop": {
    "id": 660948237,
    "name": "TESTS85AJVM1",
    "site_id": "MLA",
    "country_id": "AR",
    "domain": "test-nativas.mercadoshops.com.ar",
    "subdomain": "test-nativas",
    "home_url": "https://test-nativas.mercadoshops.com.ar",
    "status": "active",
    "date_created": "2020-10-19T21:12:03.000+0000",
    "last_updated": "2022-03-31T17:12:55.000+0000",
    "features": [
      "fs-no-mandatory",
      "use-appearance-cache",
      "customer-email-list",
      "cho-personalizado-mobile",
      "cho-personalizado-desktop",
      "login-personalizado-desktop",
      "login-personalizado-mobile",
      "cho-personalizado-mail",
      "mshops-guest-cho"
    ]
  },
  "appearance": {
    "id": "document",
    "component": "Document",
    "properties": {
      "theme": "tools",
      "styles_url": "https://http2.mlstatic.com/shops/660948237/appearance/styles/4c32feaf436239552a16ff69f3d591a5/checkout.css?scope=prod",
      "styles": [
        "https://http2.mlstatic.com/shops/660948237/appearance/styles/4c32feaf436239552a16ff69f3d591a5/checkout.css?scope=prod",
        "https://http2.mlstatic.com/shops/appearance/themes/tools/0536a38997adeec78aed7f95cd684850/styles.css?scope=prod",
        "https://http2.mlstatic.com/shops/appearance/themes/lite/e83184c3348d2493cd4afd092cb32467/styles.css?scope=prod"
      ],
      "title": "",
      "currency": {
        "decimal_places": 2,
        "decimal_separator": ",",
        "thousand_separator": "."
      },
      "meta_tags": []
    },
    "hidden": false,
    "children": [
      {
        "id": "header",
        "component": "Header",
        "properties": {
          "logo_picture_version": "A",
          "logo_object_storage_url": "https://http2.mlstatic.com/storage/mshops-appearance-api/images/37/660948237/logo-2021051010392387200.jpeg",
          "logo_alignment": "left",
          "header_message": "",
          "flash_action_href": "",
          "contact": {
            "label": "Contáctanos",
            "href": "/p/contacto"
          },
          "cart": {
            "label": "Carrito",
            "href": "/gz/cart"
          },
          "flash_message": "ENVÍOS GRATIS EN PRODUCTOS SELECCIONADOS",
          "sale": null,
          "opacity": 0.6,
          "action": {
            "message": "",
            "href": "",
            "target": "_self",
            "rel": ""
          },
          "logo": {
            "url": "https://http2.mlstatic.com/storage/mshops-appearance-api/images/37/660948237/logo-2021051010392387200.jpeg"
          },
          "raw": "<div class=\"header-wrapper custom-cho nav-header nav-logo-float-left  nav-logo-float-left \" id=\"header-wrapper\" data-ms-theme=\"lite\">\n  <header role=\"banner\" itemtype=\"http://schema.org/Store\" itemid=\"#this\" itemscope=\"\">\n    <div  class=\"header-up header--custom-background\">\n      <h1 class=\"nav-header__title\">\n        \n          <div class=\"nav-header__logo\" href=\"/\" id=\"logo-wrapper\">\n            <span class=\"nav-header__title-hidden\"></span>\n            <img class=\"nav-header__image\" src=\"https://http2.mlstatic.com/storage/mshops-appearance-api/images/37/660948237/logo-2021051010392387200.jpeg\" alt=\"\" itemprop=\"logo\" />\n          </div>\n        \n      </h1>\n    </div>\n    <div class=\"header-down\">\n      <h3 class=\"header-down__title\">Procesamos el pago y envío con tu cuenta de</h3>\n      <img class=\"header-down__image\" src=\"https://http2.mlstatic.com/frontend-assets/ui-navigation/5.18.2/mercadolibre/logo__large_plus@2x.png\" alt=\"\" itemprop=\"logo\" />\n    </div>\n    \n      <div class=\"nav-bounds\"></div>\n    \n  </header>\n</div>\n",
          "flash": false,
          "widgets": []
        },
        "hidden": false,
        "children": []
      },
      {
        "id": "layout",
        "component": "Layout",
        "properties": {},
        "hidden": false,
        "children": []
      },
      {
        "id": "footer",
        "component": "Footer",
        "properties": {
          "show_qr_data": true,
          "show_business_data": false,
          "logo_caption": "",
          "raw": "<footer class=\"nav-footer\">\n  <div class=\"nav-footer__content\">\n    <nav class=\"nav-footer__options\">\n      \n        \n          <a href=\"https://www.mercadolibre.com.ar/ayuda/terminos-y-condiciones-de-uso_991\" target=\"_blank\" class=\"nav-footer__option-element\">\n            Términos y condiciones\n          </a>\n        \n      \n        \n          <a href=\"https://www.mercadolibre.com.ar/privacidad\" target=\"_blank\" class=\"nav-footer__option-element\">\n            Cómo cuidamos tu privacidad\n          </a>\n        \n      \n        \n          <a href=\"https://www.mercadolibre.com.ar/ayuda/18697\" target=\"_blank\" class=\"nav-footer__option-element\">\n            Información al usuario financiero\n          </a>\n        \n      \n        \n          <a href=\"https://www.mercadolibre.com.ar/ayuda\" target=\"_blank\" class=\"nav-footer__option-element\">\n            Ayuda\n          </a>\n        \n      \n        \n          <a href=\"https://www.mercadolibre.com.ar/ayuda/Defensa-del-Consumidor_s20014\" target=\"_blank\" class=\"nav-footer__option-element\">\n            Defensa al consumidor\n          </a>\n        \n      \n        \n      \n    </nav>\n    <div class=\"nav-footer__text\">\n      \n        <span class=\"nav-footer__copy\">Copyright © 1999-2021 Mercadolibre S.R.L</span>\n      \n      \n        <span class=\"nav-footer__address\">Av Caseros 3039 Piso 2, CP1264, Parque patricios, CABA</span>\n      \n    </div>\n  </div>\n  \n</footer>\n"
        },
        "hidden": false,
        "children": []
      },
      {
        "id": "widgets",
        "component": "Widgets",
        "properties": {
          "widgets": [
            {
              "key": "DROP_OUT_SNIPPET",
              "code": "(function (window, document) {\n  var section = \"checkout\".toUpperCase();\n  var siteId = \"MLA\"\n  var sessionStorageKey = \"MShopsDropoutIndication\";\n\n  var sectionEventDic = {\n    LOGIN: \"mshops-login-dropout\",\n    CHECKOUT: \"mshops-checkout-dropout\"\n  };\n\n  var domainDic = {\n    MLA: \"www.mercadoshops.com.ar\",\n    MLM: \"www.mercadoshops.com.mx\",\n    MLB: \"www.mercadoshops.com.br\",\n    MCO: \"www.mercadoshops.com.co\",\n    MLC: \"www.mercadoshops.cl\"\n  }\n\n  var timeoutId, dropoutIndication; // these are needed to handle both iframes' events asyncronously\n\n  window.hj=window.hj||function(){(hj.q=hj.q||[]).push(arguments)};\n\n  function addDropoutIframe () {\n    var iframe = document.createElement(\"iframe\");\n    iframe.setAttribute(\"id\", \"dropout-frame\");\n    iframe.setAttribute(\"style\", \"position: absolute;width:0;height:0;border:0;\");\n    iframe.src = \"https://www.mercadoli\" + (siteId !== \"MLB\" ? \"b\" : \"v\") + \"re.com/mercadoshops/tracking/dropout?domain_override=\" + domainDic[siteId];\n    document.body.appendChild(iframe);\n  }\n\n  function sendDropoutEvent () {\n    hj(\"event\", sectionEventDic[dropoutIndication] + \"-\" + siteId);\n  }\n\n  function dropoutEventCallback (event) {\n    var dropoutTag = \"DROPOUT_\";\n  \n    if (event.data && event.data.match && event.data.match(dropoutTag)) {\n      var dropoutSection = event.data.replace(dropoutTag, \"\");\n\n      if (!dropoutIndication || dropoutSection === \"CHECKOUT\") {\n        dropoutIndication = dropoutSection;\n      }\n\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(sendDropoutEvent, 1000);\n    }\n  }\n\n  if (sectionEventDic[section]) {\n    sessionStorage.setItem(sessionStorageKey, section);\n  }\n\n  if (section === \"VIP\" || section === \"CART\") {\n    window.addEventListener(\"message\", dropoutEventCallback);\n    addDropoutIframe();\n  }\n  \n  if (section === \"CHECKOUT\" && window.location.href.match(/(\\w|\\d){32}\\/congrats/i)) {\n    sessionStorage.removeItem(sessionStorageKey);\n    sessionStorage.setItem(\"MShopsCompletedPurchase\", true);\n  }\n})(window, document);",
              "src": "",
              "event": "now",
              "priority": "10",
              "config": {}
            },
            {
              "key": "CHECKOUT_DEEP_LINK",
              "code": "(function (window) {\n  function sendEvent() {\n    if (typeof window.meli_ga === 'function') {\n      var eventMessage = 'FLOW';\n      var eventLabel = 'GONE_TO_NATIVE_APP';\n      var fieldsObject = { nonInteraction: true };\n      window.meli_ga('send', 'event', 'WEBVIEW', eventMessage, eventLabel, fieldsObject)\n    }\n  }\n\n  function inWebView() {\n    return (typeof window.navigator !== 'undefined' && window.navigator.userAgent.indexOf('MercadoLibre') !== -1);\n  }\n\n  function isIOS() {\n    return window.navigator && window.navigator.userAgent.match(/MercadoLibre-iOS/i)\n  }\n\n  function setNavigationButton(isFirstPage) {\n    if (!window.MobileWebKit) {\n      return;\n    }\n\n    var backStyle = isFirstPage ? (isIOS() ? 'none': 'cross') : 'arrow';\n    var backAction = isFirstPage ? 'close' : 'back';\n\n    window.MobileWebKit.executeNative({\n      method: 'back_style',\n      args: {\n        type: backStyle\n      }\n    });\n\n    window.MobileWebKit.executeNative({\n      method: 'back_action',\n      args: {\n        type: backAction\n      }\n    });\n  }\n\n  function MShopsHistory() {\n    var MSHOPS_HISTORY = 'mshopsHistory';\n\n    function filterUnreachableUrls(array) {\n      var UNREACHABLE_URLS = [/buy(ing)?-ms/];\n      return array.filter(function (url) {\n        return !UNREACHABLE_URLS.some(function (regex) {\n          return url.match(regex)\n        });\n      });\n    }\n\n    this.getHistory = function getHistory() {\n      return JSON.parse(sessionStorage.getItem(MSHOPS_HISTORY));\n    };\n\n    this.setHistory = function setHistory(stack) {\n      sessionStorage.setItem(MSHOPS_HISTORY, JSON.stringify(stack))\n    }\n\n    this.wentBackwards = function wentBackwards() {\n      return this.getHistory().indexOf(location.href) > -1;\n    };\n\n    this.isBottomOfStack = function isBottomOfStack() {\n      return this.getHistory().indexOf(location.href) === 0;\n    };\n\n    this.isCongratsPage = function isCongratsPage() {\n      var regex = /(\\w){32}\\/congrats/;\n      return regex.test(location.href);\n    };\n\n    this.pushState = function pushState() {\n      this.setHistory(this.getHistory().concat(filterUnreachableUrls([location.href])))\n    };\n\n    this.popState = function popState() {\n      var mshopsHistory = this.getHistory();\n      var stepIndex = mshopsHistory.indexOf(location.href);\n\n      if (stepIndex > -1) {\n        this.setHistory(mshopsHistory.slice(0, stepIndex + 1))\n      }\n    };\n\n    this.evaluate = function evaluate() {\n      if (!this.getHistory()) {\n        this.setHistory([])\n      }\n\n      if (this.wentBackwards()) {\n        this.popState();\n      } else {\n        this.pushState();\n      }\n\n      setNavigationButton(this.isBottomOfStack() || this.isCongratsPage());\n    };\n\n    this.evaluate();\n\n    return this;\n  }\n\n  if (inWebView()) {\n    sendEvent();\n    window.MShopsHistory = MShopsHistory();\n  }\n\n})(window);",
              "src": "",
              "event": "now",
              "priority": "10",
              "config": {}
            },
            {
              "key": "LINKER_V2_SNIPPET",
              "code": "(function (window, document) {\n  var DOMAINS = [\n    'mercadolibre.com',\n    'mercadolivre.com',\n    'mercadolibre.com.ar',\n    'mercadolivre.com.br',\n    'mercadolibre.com.mx',\n    'mercadolibre.cl',\n    'mercadolibre.com.co',\n  ];\n  var DESTINATION_PATTERN = new RegExp('(?:' + DOMAINS.join('|') + ')$');\n  var LINKER_V2_PATTERN = '$version.$hash.$clientId';\n  var LINKER_V2_VERSION = 'ML1';\n  var QUERY_PARAM_SEPARATOR = '?';\n  var CHO_BASE_URL = 'gz/checkout/buy-ms';\n\n  function LinkerV2(clientId) {\n    this.getGAClientId = function getGAClientId() {\n      var hash = Date.now(); // TODO: Change Date.now for Hash Fn\n      return LINKER_V2_PATTERN\n        .replace('$version', LINKER_V2_VERSION)\n        .replace('$hash', hash)\n        .replace('$clientId', clientId);\n    }\n  }\n\n  function onHtmlChanges(callback) {\n    function useMutationObserverApi(cb) {\n      MutationObserver = window.MutationObserver || window.WebKitMutationObserver;\n\n      if (!MutationObserver) {\n        return false;\n      }\n\n      var observer = new MutationObserver(cb);\n      observer.observe(document, {\n        subtree: true,\n        attributes: true\n      });\n      return true;\n    }\n\n    function useFallbackDomSubtreeModified(cb) {\n      document.body.addEventListener('DOMSubtreeModified', cb, false);\n    }\n\n    callback(); // Execute the callback in the first render\n\n    if (!useMutationObserverApi(callback)) {\n      useFallbackDomSubtreeModified(callback);\n    }\n  }\n\n  function decorateLinks(clientId) {\n    var linkerV2 = new LinkerV2(clientId);\n\n    function isMarketplaceHost(hostname) {\n      return DESTINATION_PATTERN.test(hostname);\n    }\n\n    function decorateMarketplaceLink(link) {\n      return link + (link.includes(QUERY_PARAM_SEPARATOR) ? '&' : QUERY_PARAM_SEPARATOR) + '_ga=' + linkerV2.getGAClientId();\n    }\n\n    function getHostNameFromUrl(url) {\n      try {\n        return url.match(/https?:\\/\\/([^/]+)/i)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n\n    function isCheckoutUrl(url) {\n      return url.includes(CHO_BASE_URL);\n    }\n\n    function onAnchorClicked(event) {\n      // We decorate the link just when the user clicks the anchor because we want the timestamp to be accurate\n      // for when we deduct if the client is on the same buying flow. \n      // We also want to prevent the users from copying the link with their id in case they share it.\n      event.currentTarget.href = decorateMarketplaceLink(event.currentTarget.href);\n    }\n\n    function onFormSubmit(event) {\n      // We set the value when the submit event is dispatched since the gaValue depends\n      // on the time it is executed because it returns a value with Date.now()\n      event.target._ga.value = linkerV2.getGAClientId();\n    }\n\n    function decorateNonModalPathToCheckout() {\n      var forms = document.querySelectorAll('form');\n\n      for (var i = 0; i < forms.length; i++) {\n        var form = forms[i];\n        var buttons = form.querySelectorAll('button');\n\n        for (var j = 0; j < buttons.length; j++) {\n          var button = buttons[j];\n\n          if (isCheckoutUrl(button.formAction)) {\n            if (!form.querySelector('*[name=\"_ga\"]')) {\n              var gaField = document.createElement('input');\n              gaField.setAttribute('type', 'hidden');\n              gaField.setAttribute('name', '_ga');\n              gaField.setAttribute('value', linkerV2.getGAClientId());\n              form.appendChild(gaField);\n              form.addEventListener('submit', onFormSubmit);\n            }\n          }\n        }\n      }\n    }\n\n    onHtmlChanges(function () {\n      decorateNonModalPathToCheckout();\n      // Decorates anchors\n      var anchors = document.querySelectorAll('a');\n      for (var i = 0; i < anchors.length; i++) {\n        var anchor = anchors[i];\n\n        if (isMarketplaceHost(getHostNameFromUrl(anchor.href))) {\n          anchor.addEventListener('click', onAnchorClicked);\n        }\n      }\n\n      // Decorate forms\n      var forms = document.querySelectorAll('form');\n\n      for (var i = 0; i < forms.length; i++) {\n        var form = forms[i];\n\n        if (isMarketplaceHost(getHostNameFromUrl(form.action))) {\n          if (!form.querySelector('*[name=\"_ga\"]')) {\n            var gaField = document.createElement('input');\n            gaField.setAttribute('type', 'hidden');\n            gaField.setAttribute('name', '_ga');\n            gaField.setAttribute('value', linkerV2.getGAClientId());\n            form.appendChild(gaField);\n          }\n          form.addEventListener('submit', onFormSubmit);\n        }\n      }\n    });\n  }\n\n  var ClientManager = (function () {\n    var clientId = null;\n\n    return {\n      getId: function () {\n        return clientId;\n      },\n      setId: function (newClientId) {\n        clientId = newClientId;\n      }\n    };\n  })();\n\n  if (typeof window.meli_ga !== 'function') {\n    return;\n  }\n\n  window.meli_ga(function (tracker) {\n    var clientId = tracker.get('clientId');\n    decorateLinks(clientId);\n    ClientManager.setId(clientId);\n  });\n\n  window.traceability = function (callback) {\n    callback({\n      get: function get(parameter) {\n        if (parameter === 'clientId') {\n          return ClientManager.getId();\n        }\n      }\n    });\n  };\n\n  // Send event to differentiate webviews\n  (function onWebviewSendEvent(meli_ga, userAgent) {\n    if (userAgent.match(/MercadoLibre-(?:Android|iOS)/)) {\n      meli_ga('send', 'event', 'WEBVIEW', 'ON_WEBVIEW', userAgent, {\n        nonInteraction: true\n      });\n    }\n  })(meli_ga, navigator.userAgent);\n})(window, document);",
              "src": "",
              "event": "now",
              "priority": "0",
              "config": {}
            },
            {
              "key": "TRACKING_MEDIATOR",
              "code": "'use strict';\n\n(function trackingMediator(w, tm) {\n  var TYPE = { DISPATCH: 'DISPATCH', STORE: 'STORE', ERASE: 'ERASE', ON: 'ON', OFF: 'OFF' };\n  var data = {};\n  var events = {};\n  var history = [];\n  var namespace = {\n    /**\n     * Stores a certain configuration in the data object, expanding current\n     * @param {any} configuration\n     */\n    store: function store(configuration) {\n      data.configuration = Object.assign({}, data.configuration, configuration);\n      history.push({ type: TYPE.STORE, configuration: configuration });\n    },\n    /**\n     * Retrieves stored configuration\n     */\n    retrieve: function retrieve() {\n      return data;\n    },\n    /**\n     * Removes the stored configuration\n     */\n    erase: function erase() {\n      data.configuration = {};\n      history.push({ type: TYPE.ERASE });\n    },\n    /**\n     * Dispatchs a certain event with parameters\n     */\n    dispatch: function dispatch() {\n      var eventName = Array.prototype.shift.apply(arguments);\n      var eventData = Array.prototype.slice.call(arguments);\n      history.push({ type: TYPE.DISPATCH, name: eventName, data: eventData });\n      if (typeof events[eventName] !== 'undefined') {\n        events[eventName].forEach(function execute(callback) {\n          callback.apply(null, eventData);\n        });\n      }\n    },\n    /**\n     * Adds a listener\n     */\n    on: function on(eventName, callback) {\n      if (typeof events[eventName] === 'undefined') {\n        events[eventName] = [];\n      }\n      events[eventName].push(callback);\n      history.push({ type: TYPE.ON, name: eventName, callback: callback });\n    },\n    /**\n     * Removes the listener\n     */\n    off: function off(eventName, callback) {\n      if (typeof events[eventName] !== 'undefined') {\n        var index = events[eventName].indexOf(callback);\n        if (index !== -1) {\n          events[eventName].splice(index, 1);\n          history.push({ type: TYPE.OFF, name: eventName, callback: callback });\n        }\n      }\n    },\n    /**\n     * Retrieves a copy of the history of dispatched events\n     */\n    history: function getHistory() {\n      return history;\n    },\n  };\n  // Expose the method to window\n  w[tm] = function expose() {\n    var method = Array.prototype.shift.apply(arguments);\n    var props = Array.prototype.slice.call(arguments);\n    return namespace[method].apply(namespace[method], props);\n  };\n}(window, 'tracking_mediator'));",
              "src": "",
              "event": "now",
              "priority": "1",
              "config": {}
            },
            {
              "key": "GOOGLE",
              "code": "var DOMAINS = [\n  'mercadolibre.com',\n  'mercadolivre.com',\n  'mercadolibre.com.ar',\n  'mercadolivre.com.br',\n  'mercadolibre.com.mx',\n  'mercadolibre.cl',\n  'mercadolibre.com.co',\n];\nvar DESTINATION_PATTERN = new RegExp('(?:' + DOMAINS.join('|') + ')$');\n\nvar LINKER_V2_COOKIE = /_linker_v2=true/;\nvar CLIENT_ID_LINKER_V2_PATTERN = /[&?]_ga=ML\\d+\\.(\\w+)\\.([^&]+)/i;\n\n// The waiting time becomes long due to the time the user could be at login/registration in native apps,\n// which we don't control, so we have to take into consideration.\n// In avg, a user spends 30s in login and 3 min in registration, we triple that time\nvar TIME_BETWEEN_LOADING_CROSS_DOMAIN_IN_MS = 10 * 60 * 1000; // X minutes (X * 60 * 1000)\n\nvar OLD_STORE_CONFIGURATION_PARAMS = {\n  cookie_prefix: '_mshops',\n  linker: {\n    name: 'source_name',\n    domains: DOMAINS,\n    decorate_forms: true\n  }\n};\nvar OLD_MARKETPLACE_CONFIGURATION_PARAMS = {\n  referrer: '',\n  referer: '',\n  page_referrer: '',\n  page_referer: '',\n  cookie_prefix: '_mshops',\n  linker: {\n    name: 'destination_name',\n    accept_incoming: true\n  }\n};\n\nfunction LinkerV2(locationSearch) {\n  this.isEnabledForStore = function isEnabledForStore() {\n    return LINKER_V2_COOKIE.test(document.cookie);\n  }\n\n  this.isEnabledForMarketplace = function isEnabledForMarketplace() {\n    return CLIENT_ID_LINKER_V2_PATTERN.test(locationSearch);\n  }\n}\n\n\nfunction MeliGaHandler() {\n  this.getClientId = function getClientId() {\n    var clientId = null;\n    \n    try {\n      window.meli_ga(function (tracker) {\n        clientId = tracker.get('clientId');\n      });\n    } catch (e) { /* do nothing */ }\n\n    return clientId;\n  }\n}\n\n// Polyfill taken from MDN. It is used for merging old configuration objects with the new one associated with linker_v2\n// https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Object/assign\nfunction mergeObjects(target) {\n  if (target === null || typeof target === 'undefined') {\n    throw new TypeError('Cannot convert undefined or null to object');\n  }\n  var to = Object(target);\n  for (var index = 1; index < arguments.length; index++) {\n    var nextSource = arguments[index];\n    if (nextSource !== null && typeof nextSource !== 'undefined') {\n      for (var nextKey in nextSource) {\n        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n          to[nextKey] = nextSource[nextKey];\n        }\n      }\n    }\n  }\n  return to;\n};\n\nfunction loadGoogleTagManagerScript(googleAccountId) {\n  var scriptEl = document.createElement('script');\n  scriptEl.type = 'text/javascript';\n  scriptEl.async = true;\n  scriptEl.src = 'https://www.googletagmanager.com/gtag/js?id=' + googleAccountId;\n  document.getElementsByTagName('head')[0].appendChild(scriptEl);\n}\n\n/**\n * BACKWARDS COMPATIBILITY FOR LINKER V1\n */\nfunction addBackwardsCompatibilityForStore(linkerV2, analyticsParams) {\n  if (linkerV2.isEnabledForStore()) {\n    return mergeObjects(analyticsParams.configurationV2, analyticsParams.configurationBase);\n  } else {\n    return mergeObjects(OLD_STORE_CONFIGURATION_PARAMS, analyticsParams.configurationBase);\n  }\n}\n\nfunction addBackwardsCompatibilityForMarketplace(linkerV2, analyticsParams) {\n  if (linkerV2.isEnabledForMarketplace()) {\n    return mergeObjects(analyticsParams.configurationV2, analyticsParams.configurationBase);\n  } else {\n    return mergeObjects(OLD_MARKETPLACE_CONFIGURATION_PARAMS, analyticsParams.configurationBase);\n  }\n}\n\n/**\n * BUILD CONFIGURATION\n * The following lines are dedicated to the setup of GTAG\n */\nfunction buildConfigurationForStore(linkerV2, pagePath) {\n  var meliGaHandler = new MeliGaHandler();\n  return addBackwardsCompatibilityForStore(linkerV2, {\n    configurationBase: {\n      page_path: pagePath,\n      cookie_prefix: '_mshops',\n    },\n    configurationV2: {\n      client_id: meliGaHandler.getClientId(),\n    }\n  });\n}\n\nfunction buildConfigurationForMarketplace(linkerV2, pagePath) {\n  var meliGaHandler = new MeliGaHandler();\n  return addBackwardsCompatibilityForMarketplace(linkerV2, {\n    configurationBase: {\n      page_path: pagePath,\n      cookie_prefix: '_mshops',\n    },\n    configurationV2: {\n      client_id: meliGaHandler.getClientId(),\n      referrer: '',\n      referer: '',\n      page_referrer: '',\n      page_referer: '',\n    }\n  });\n}\n\nfunction isMarketplaceHost(hostname) {\n  return DESTINATION_PATTERN.test(hostname);\n}\n\nfunction buildConfiguration(location, pagePath) {\n  var linkerV2 = new LinkerV2(location && location.search);\n  return isMarketplaceHost(location && location.hostname) \n    ? buildConfigurationForMarketplace(linkerV2, pagePath)\n    : buildConfigurationForStore(linkerV2, pagePath);\n}\n\nloadGoogleTagManagerScript('AW-349846374');\n\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag() { dataLayer.push(arguments); }\n\ngtag('js', new Date());\n\n\ngtag('config', 'AW-349846374' );\n// Analytics Ecommerce\nvar DEBUGGER_COOKIE = '_debug_checkout=true';\n\nvar googleAnalyticsTag = ''\nvar googleAdsAccountId = 'AW-349846374'\nvar LAST_TRANSACTION_ID = 'LAST_TRANSACTION_ID_' + googleAnalyticsTag;\nvar LAST_TRANSACTION_ID_CONVERSION = 'LAST_TRANSACTION_ID_CONVERSION_' + googleAdsAccountId;\n\nvar CONGRATS_STATUS_NOT_ALLOWED = [\n    'ERROR_RECOVERABLE_BI',\n    'CANCELLED',\n    'ERROR_NON_RECOVERABLE_BI',\n    'REJECTED',\n    'error',\n    'ERROR',\n];\n\nvar SHOPS_WITH_CONCATENATE = [579420498, 136981981, 116155669]\n\nfunction debug_log(message) {\n    if(document.cookie.match(DEBUGGER_COOKIE)) {\n        console.log('%c[DEBUGGER]', 'background:blue;color:white');\n        console.log(message);\n    }\n}\n\nfunction getLastTransactionIdSent(key){\n    debug_log('returning last transaction id');\n    debug_log(key)\n    return window.localStorage.getItem(key);\n}\n\nfunction setLastTransactionIdSent(key, current_transaction_id){\n    debug_log('saved transaction id');\n    debug_log(current_transaction_id);\n    debug_log('key save localStorage');\n    debug_log(key);\n    window.localStorage.setItem(key, current_transaction_id);\n}\n\nfunction getTrackData(callback) {\n    try {\n        debug_log('returning track data')\n        setTimeout(() => {\n            var data = (\n                window.tracking_mediator('retrieve').configuration\n                || JSON.parse(window.sessionStorage.getItem('mercadoShopsTrackingData'))\n                || {}\n            )\n            callback(data)\n        }, 500);\n    } catch (e) {\n        debug_log(e)\n        return {}\n    }\n}\n\nfunction isTrackDataEmpty(trackData, trackProps) {\n    for (var i in trackProps) {\n        var prop = trackProps[i];\n        if (!trackData[prop]) {\n            debug_log('prop ' + prop + ' is missing');\n            return true;\n        }\n    }\n    debug_log('Track is OK');\n    return false;\n}\n\nfunction reportErrorToDatadog(trackData, page) {\n    // TODO: Add fetch to DATADOG: Currently failing with CORS Error\n    debug_log('Reporting to Datadog');\n    debug_log(trackData);\n}\n\nwindow.tracking_mediator('on', 'melidata:page', function (data) {\n    if (data.data && data.data.path === '/checkout/generic_error') {\n        return;\n    }\n\n    var eventData = data.data && data.data.event_data ? data.data.event_data : { items: [] };\n    var items = eventData.items.map(function (it) {\n        var item = it.item || {};\n        return {\n            id: item.id,\n            name: item.title,\n            list_position: 1,\n            quantity: it.quantity,\n            price: it.unit_price\n        };\n    });\n\n    var mercadoShopsTrackingData = {\n        items: items,\n        price: eventData.total_amount,\n        currency: eventData.items[0] && eventData.items[0].currency_id,\n        transaction_id: eventData.session_id,\n        congrats_status: eventData.congrats_status,\n        order_id: eventData.order_id,\n        shop_id: eventData.seller && eventData.seller[0],\n    };\n    window.sessionStorage.setItem('mercadoShopsTrackingData', JSON.stringify(mercadoShopsTrackingData));\n    window.tracking_mediator('store', mercadoShopsTrackingData);\n});\n\nwindow.tracking_mediator('on', 'analytics:page', function (data) {\n    if (data.page === '/CHECKOUT/CONGRATS/' || data.page === '/CART/CHECKOUT/CONGRATS/') {\n\n        getTrackData(function (trackData) {\n            var last_transaction_id_sent = getLastTransactionIdSent(LAST_TRANSACTION_ID);\n            var last_transaction_id_sent_conversion = getLastTransactionIdSent(LAST_TRANSACTION_ID_CONVERSION);\n            var current_transaction_id = trackData.transaction_id;\n\n            debug_log('track data');\n            debug_log(trackData);\n            debug_log(data);\n    \n            debug_log('data to validate');\n            debug_log({\n                order_id: trackData.order_id,\n                current_transaction_id: current_transaction_id,\n                last_transaction_id_sent: last_transaction_id_sent,\n                last_transaction_id_sent_conversion: last_transaction_id_sent_conversion,\n                congrats_status: trackData.congrats_status,\n            });\n    \n            \n                    if (\n                        last_transaction_id_sent_conversion == current_transaction_id ||\n                        CONGRATS_STATUS_NOT_ALLOWED.includes(trackData.congrats_status)\n                    ) {\n                        return debug_log('Track not allowed googleAdsConversion');\n                    }\n                    if (isTrackDataEmpty(trackData, ['price', 'currency', 'transaction_id'])) {\n                        return reportErrorToDatadog(trackData);\n                    }\n                \n                    gtag(\n                        'event',\n                        'conversion',\n                        {\n                            send_to: 'AW-349846374/HD_uCN6vpdsCEOb26KYB',\n                            value: trackData.price,\n                            currency: trackData.currency,\n                            transaction_id: trackData.transaction_id\n                        }\n                    );\n                    debug_log('Track sent googleAdsConversion');\n                    setLastTransactionIdSent(LAST_TRANSACTION_ID_CONVERSION, current_transaction_id);\n            \n            \n        });\n    }\n});",
              "src": "",
              "event": "now",
              "priority": "10",
              "config": {}
            },
            {
              "key": "FACEBOOK_PIXEL",
              "code": "!function(f,b,e,v,n,t,s)\n{if(f.fbq)return;n=f.fbq=function(){n.callMethod?\nn.callMethod.apply(n,arguments):n.queue.push(arguments)};\nif(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\nn.queue=[];t=b.createElement(e);t.async=!0;\nt.src=v;s=b.getElementsByTagName(e)[0];\ns.parentNode.insertBefore(t,s)}(window, document,'script',\n'https://connect.facebook.net/en_US/fbevents.js');\nfbq('init', '1536101823398968', {}, {'agent':'plmercadoshops2.0'});\nfbq('track', 'PageView');\n\nvar DEBUGGER_COOKIE = '_debug_checkout=true';\n\nvar LAST_TRANSACTION_ID_FB = 'LAST_TRANSACTION_ID_FB';\n\nvar CONGRATS_STATUS_NOT_ALLOWED = [\n    'ERROR_RECOVERABLE_BI',\n    'CANCELLED',\n    'ERROR_NON_RECOVERABLE_BI',\n    'REJECTED',\n    'error',\n    'ERROR',\n];\n\nfunction debug_log(message) {\n    if (document.cookie.match(DEBUGGER_COOKIE)) {\n        console.log('%c[DEBUGGER]: ', 'background:blue;color:white');\n        console.log(message);\n    }\n}\n\nfunction getLastTransactionIdSent(){\n    debug_log('returning last transaction id');\n    return window.localStorage.getItem(LAST_TRANSACTION_ID_FB);\n}\n\nfunction setLastTransactionIdSent(current_transaction_id){\n    debug_log('saved transaction id');\n    debug_log(current_transaction_id);\n    window.localStorage.setItem(LAST_TRANSACTION_ID_FB, current_transaction_id);\n}\n\nfunction getTrackData(callback) {\n    try {\n        debug_log('returning track data')\n        setTimeout(() => {\n            var data = (\n                window.tracking_mediator('retrieve').configuration\n                || JSON.parse(window.sessionStorage.getItem('mercadoShopsTrackingData'))\n                || {}\n            )\n            callback(data)\n        }, 500);\n    } catch (e) {\n        debug_log(e)\n        return {}\n    }\n}\n\nfunction isTrackDataEmpty(trackData, trackProps) {\n    for (var i in trackProps) {\n        var prop = trackProps[i];\n        if (!trackData[prop]) {\n            debug_log('prop ' + prop + ' is missing')\n            return true;\n        }\n    }\n    debug_log('Track is OK');\n    return false;\n}\n\nfunction reportErrorToDatadog(trackData, page) {\n    // TODO: Add fetch to DATADOG: Currently failing with CORS Error\n    debug_log('Reporting to Datadog');\n    debug_log(trackData);\n}\n\nwindow.tracking_mediator('on', 'melidata:page', function (data) {\n    if (data.data && data.data.path === '/checkout/generic_error') {\n        return;\n    }\n\n    var eventData = data.data && data.data.event_data ? data.data.event_data : { items: [] };\n    var items = eventData.items.map(function (it) {\n        var item = it.item || {};\n        return {\n            id: item.id,\n            name: item.title,\n            list_position: 1,\n            quantity: it.quantity,\n            price: it.unit_price\n        };\n    });\n\n    var mercadoShopsTrackingData = {\n        items: items,\n        price: eventData.total_amount,\n        currency: eventData.items[0] && eventData.items[0].currency_id,\n        transaction_id: eventData.session_id,\n        congrats_status: eventData.congrats_status,\n        order_id: eventData.order_id,\n        shop_id: eventData.seller && eventData.seller[0],\n    };\n    window.sessionStorage.setItem('mercadoShopsTrackingData', JSON.stringify(mercadoShopsTrackingData));\n    window.tracking_mediator('store', mercadoShopsTrackingData);\n});\n\nwindow.tracking_mediator('on', 'analytics:page', function (data) {\n    getTrackData(function (trackData){\n        debug_log(trackData);\n        debug_log(data);\n\n        if (isTrackDataEmpty(trackData, ['items', 'price', 'currency'])) {\n            return reportErrorToDatadog(trackData, data.page)\n        }\n\n        if (data.page === '/CHECKOUT/PAYMENT/SELECT_TYPE/' || data.page === '/CART/CHECKOUT/PAYMENT/SELECT_TYPE/') {\n\n            var eventData = {\n                contents: trackData.items,\n                value: trackData.price,\n                content_type: 'product',\n                currency: trackData.currency,\n                num_items: trackData.items.length\n            };\n\n            if(eventData.contents && eventData.value && eventData.currency && eventData.num_items) {\n                fbq('track', 'InitiateCheckout', eventData);\n            }\n        }\n\n        if (data.page === '/CHECKOUT/CONGRATS/' || data.page === '/CART/CHECKOUT/CONGRATS/') {\n\n            var last_transaction_id_sent = getLastTransactionIdSent();\n\n            var current_transaction_id = trackData.transaction_id;\n\n            debug_log('data to validate');\n            debug_log({\n                order_id: trackData.order_id,\n                current_transaction_id: current_transaction_id,\n                last_transaction_id_sent: last_transaction_id_sent,\n                congrats_status: trackData.congrats_status,\n            });\n\n            if (\n                last_transaction_id_sent == current_transaction_id ||\n                CONGRATS_STATUS_NOT_ALLOWED.includes(trackData.congrats_status)\n            ) {\n                return debug_log('Track not allowed');\n            }\n\n            var eventData = {\n                contents: trackData.items,\n                content_type: 'product',\n                value: trackData.price,\n                currency: trackData.currency\n            };\n\n            if(eventData.contents && eventData.value && eventData.currency) {\n                fbq('track', 'Purchase', eventData);\n                debug_log('Track sent');\n                setLastTransactionIdSent(current_transaction_id);\n            }\n        }\n    });\n});",
              "src": "",
              "priority": "10",
              "config": {}
            }
          ]
        },
        "hidden": false,
        "children": []
      },
      {
        "id": "pads",
        "component": "Pads",
        "properties": {
          "logo_url": "https://http2.mlstatic.com/storage/mshops-appearance-api/images/37/660948237/logo-2021051010392387200.jpeg",
          "background_color": "#36908b",
          "text_color": "#985656",
          "banner_image_url": null
        },
        "hidden": false,
        "children": []
      }
    ]
  },
  "fiscal_data": {},
  "discount_campaigns": [
    {
      "campaign_id": "10112959",
      "campaign_type": "COUPON",
      "status": "ACTIVE",
      "value": 20
    },
    {
      "campaign_id": "10112900",
      "campaign_type": "COUPON",
      "status": "ACTIVE",
      "value": 20
    },
    {
      "campaign_id": "10112895",
      "campaign_type": "COUPON",
      "status": "ACTIVE",
      "value": 20
    },
    {
      "campaign_id": "10112951",
      "campaign_type": "COUPON",
      "status": "ACTIVE",
      "value": 20
    }
  ]
}
