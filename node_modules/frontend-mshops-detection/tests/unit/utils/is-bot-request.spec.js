const isBotRequest = require('../../../src/utils/is-bot-request');
const config = require('../../../src/config');

jest.mock('../../../src/config');

describe('Utils --> isBotRequest', () => {
  describe('cases where user agent is from a bot', () => {
    const botAgents = ['bot', 'curl', 'postman', 'java', 'spider', 'facebookexternalhit', 'ruby'];

    botAgents.forEach(agent => {
      it(`should return true when user agent contains ${agent}`, () => {
        expect(isBotRequest(agent)).toEqual(true);
      });
    });
  });

  describe('cases where user agent is not from a bot', () => {
    const validAgents = ['mozilla', 'chrome'];

    validAgents.forEach(agent => {
      it(`should return false when user agent contains ${agent}`, () => {
        expect(isBotRequest(agent)).toEqual(false);
      });
    });

    describe('but config for robots is true', () => {
      beforeEach(() => {
        config.features.robots = true;
      });

      validAgents.forEach(agent => {
        it('should return true', () => {
          expect(isBotRequest(agent)).toEqual(true);
        });
      });
    });
  });
});
