/**
 * Module dependencies
 */
const httpMocks = require('node-mocks-http');
const setPlatform = require('../../../src/utils/set-platform');

/**
 * Tests
 */
describe('Utils > setPlatform', () => {
  const defaultPlatformSet = {
    id: 'MS',
    siteId: null,
    countryId: null,
    domain: null,
  };

  let req;

  beforeAll(() => {
    req = httpMocks.createRequest();
  });

  test('if the data is empty, it should set the default with nulls', () => {
    // WHEN
    setPlatform(req);

    // THEN
    expect(req.platform).toEqual(defaultPlatformSet);
  });

  test('if the data exist, it should be used to fill the req.platform', () => {
    const shop = {
      site_id: 'MLM',
      country_id: 'MX',
      domain: 'example.mercadoshops.com.mx',
    };

    // WHEN
    setPlatform(req, { shop });

    // THEN
    expect(req.platform).toEqual({
      shop,
      id: 'MS',
      siteId: 'MLM',
      countryId: 'MX',
      domain: 'example.mercadoshops.com.mx',
    });
  });
});
