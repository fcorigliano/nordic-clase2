const dataDog = require('./data-dog');
const {
  LOG_INTERNAL_ERROR,
} = require('./constants.js');

const log = (options, logger) => {
  if (options.message) {
    try {
      const message = options.message;

      const tags = options.tags || {};

      if (options.errorType) {
        tags.errorType = options.errorType;
      }

      if (options.req) {
        if (options.req.platform) {
          tags.platformId = options.req.platform.id;
          tags.siteId = options.req.platform.siteId;
        }

        tags.originalUrl = options.req.originalUrl;

        // User Id
        const user = options.req.user;
        if (user) {
          tags.userId = user.id;
        }
      }

      logger.info(message, tags);
    } catch (internalError) {
      dataDog.send({
        errorType: LOG_INTERNAL_ERROR,
        url: (options.req || {}).originalUrl,
        name: options.name,
        tags: {
          originalErrorType: options.errorType,
        },
      }, true);
    }
  }
};


module.exports = log;
