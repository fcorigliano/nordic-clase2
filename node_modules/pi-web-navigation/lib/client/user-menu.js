"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s,a,o=(s={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},a=/[&<>'"]/g,{escape:function(e){return e.replace(a,(function(e){return s[e]}))}}).escape,u=function(e){var t=document.createElement("textarea");return t.insertAdjacentHTML("afterbegin",o(e)),t.value},c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,e),!t.mainDomain)throw new Error("UserMenuWidget: missing main domain.");if(!t.menuData)throw new Error("UserMenuWidget: missing menu data.");if(!t.userId)throw new Error("UserMenuWidget: missing user id.");if(!t.siteId)throw new Error("UserMenuWidget: missing site id.");if(!t.platformId)throw new Error("UserMenuWidget: missing platform id.");if(this.menuData=t.menuData,this.mymlUrl=t.myaccountUrl||"https://www.".concat(t.mainDomain,"/miportal/miportal.aspx"),this.endpoint="//www.".concat(t.mainDomain,"/pi/home/api/menu?siteId=").concat(t.siteId,"&userId=").concat(t.userId,"&platformId=").concat(t.platformId),this.triggerElement=t.triggerElement||document.querySelector("header .nav-header-user"),this.targetElement=t.targetElement||document.querySelector("header .nav-header-user-layer"),this.referenceElements={chevron:t.chevronReferenceElement||document.querySelector("header .nav-header-username-chevron"),rightLimit:t.rightLimitReferenceElement||document.querySelector("header .nav-icon-cart")||document.querySelector("header .option-help")||document.querySelector("header .nav-icon-notifications")},this.bus=t.bus||window.freya,!this.bus)throw new Error("UserMenuWidget: missing bus.");if(!this.targetElement||!this.triggerElement)throw new Error("UserMenuWidget: Did not find or get target,\n      trigger or avatarHeader DOM elements for UserMenuWidget");this.render(),this.widgetShouldShow(),this.fetchData(),this.handleOutsideClick=this.handleOutsideClick.bind(this),this.shown=!1,this.shouldBeClosed=!0,this.timeouts={show:null,hide:null}}var n,s,a;return n=e,(s=[{key:"fetchData",value:function(){var e=this,n=new XMLHttpRequest;n.onload=function(){if(200===n.status){var i=n.response||n.responseText,r=JSON.parse(i)||{};e.menuData=t(t({},e.menuData),r),e.render(),e.widgetShouldShow()}},n.onerror=function(){throw new Error("UserMenuWidget: failed fetching user menu.")},n.open("GET",this.endpoint,!0),n.withCredentials=!0,n.send()}},{key:"widgetShouldShow",value:function(){var e=window.getComputedStyle(this.triggerElement,":before").getPropertyValue("opacity");parseInt(e,10)&&this.show()}},{key:"render",value:function(){var e,t,n,i,r,s;this.targetElement.classList.add("user-menu--hidden"),this.targetElement.classList.add("user-menu"),this.targetElement.innerHTML=(e=this.menuData,t=e.primaryAction,n=e.email,i=e.picture,r=e.shortcuts,s=e.title,'\n    <div class="user-menu__main">\n      '.concat(function(e,t,n,i){var r='<p class="user-menu__user-badge-email">'.concat(t,"</p>");return'\n    <div class="user-menu__user-info-outer-container">\n      <div class="user-menu__user-info-inner-container">\n        <div class="user-menu__user-badge">\n          <div class="user-menu__user-badge-image">\n            '.concat(function(e){var t=e?'src="'.concat(e,'" srcset="').concat(e.replace("-S","-G"),' 2x"'):"hidden";return"\n    ".concat(!e&&'<span data-js="user-menu:avatar-icon"><svg class="user-menu__user-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 68"><defs><circle id="user-menu__avatar-circle" cx="22.706" cy="22.706" r="22.706"/></defs><g fill="none" fill-rule="evenodd"><circle cx="34" cy="34" r="34" fill="#EEE"/><g transform="translate(11 9)"><mask id="user-menu__avatar-mask" fill="#fff"><use xlink:href="#user-menu__avatar-circle"/></mask><path fill="#BBB" fill-rule="nonzero" d="M23.011 62.588c-8.466 0-15.329-6.863-15.329-15.329 0-8.466 6.863-15.33 15.33-15.33 8.465 0 15.328 6.864 15.328 15.33 0 8.466-6.863 15.33-15.329 15.33zm0-1.419c7.682 0 13.91-6.228 13.91-13.91s-6.228-13.91-13.91-13.91-13.91 6.228-13.91 13.91 6.228 13.91 13.91 13.91z" mask="url(#user-menu__avatar-mask)"/></g><path fill="#BBB" fill-rule="nonzero" d="M34.062 33.311a6.971 6.971 0 0 0 0-13.942v1.419a5.552 5.552 0 1 1 0 11.104v1.42z"/><path fill="#BBB" fill-rule="nonzero" d="M34.009 37.233c-6.046 0-10.947-4.9-10.947-10.946 0-6.046 4.901-10.947 10.947-10.947 6.045 0 10.946 4.901 10.946 10.947 0 6.045-4.9 10.946-10.946 10.946zm0-1.419a9.527 9.527 0 1 0 0-19.055 9.527 9.527 0 0 0 0 19.055z"/><path fill="#EEE" d="M41.056 15.442l2.817 2.816-3.755 3.755-2.816-2.816z"/></g></svg></span>','\n    <img data-js="user-menu:avatar-picture" ').concat(t,' class="user-menu__avatar-picture" />')}(n),'\n          </div>\n          <p class="user-menu__user-badge-title">').concat(i,"</p>\n          ").concat(r,'\n        </div>\n    </div>\n    <a href="').concat(e.target,'#menu-user"\n      class="andes-button andes-button--filled user-menu__primary-action"\n      data-id="').concat(e.id,'" rel="nofollow">\n      <span class="andes-button__content">').concat(e.label,"</span>\n    </a>\n  </div>\n  ")}(t,u(n||""),i,u(s||"")),"\n      ").concat(function(e){return'\n  <div class="user-menu__shortcuts">\n    '.concat(e.map((function(e){var t=e.id,n=e.label,i=e.target;return"points"!==t?'<a href="'.concat(i,'#menu-user" data-id="').concat(t,'" rel="nofollow">').concat(n,"</a>"):null})).join(""),"\n  </div>\n")}(r),'\n    </div>\n    <span class="user-menu__chevron"></span>\n  ')),this.addMyAccountLink(),this.bindEvents()}},{key:"addMyAccountLink",value:function(){var e=this,t=document.querySelector('label[for="nav-header-user-switch"]'),n=document.createElement("a");if(n.href=this.mymlUrl,n.className="nav-header-user-myml",n.addEventListener("click",(function(e){e.preventDefault()})),t){for(;t.childNodes.length>0;)n.appendChild(t.childNodes[0]);t.appendChild(n),t.addEventListener("click",(function(t){e.shown||t.preventDefault()}))}}},{key:"bindEvents",value:function(){var e=this;this.bus.on("user-menu:show",this.show.bind(this)),this.bus.on("user-menu:hide",this.hide.bind(this)),this.targetElement.addEventListener("click",(function(e){return e.stopPropagation()})),this.triggerElement.addEventListener("mouseenter",(function(t){t.stopPropagation(),t.preventDefault(),e.shown||e.showTimer()})),[this.triggerElement,this.targetElement].forEach((function(t){t.addEventListener("mouseenter",e.hideTimerCleaner.bind(e))})),[this.triggerElement].forEach((function(t){t.addEventListener("mouseleave",e.handleMouseLeave.bind(e))}))}},{key:"show",value:function(){this.shown||(this.bus.emit("user-menu:show:before"),this.updateMenuPosition(),this.targetElement.classList.remove("user-menu--hidden"),this.shown=!0,this.bus.emit("user-menu:show:after"),document.addEventListener("click",this.handleOutsideClick))}},{key:"hide",value:function(){this.shown&&(this.bus.emit("user-menu:hide:before"),this.targetElement.classList.add("user-menu--hidden"),this.shown=!1,this.bus.emit("user-menu:hide:after"),document.removeEventListener("click",this.handleOutsideClick))}},{key:"handleOutsideClick",value:function(e){this.triggerElement.contains(e.target)||(this.shouldBeClosed=!0,this.hide())}},{key:"handleMouseLeave",value:function(){this.showTimerCleaner(),this.hideTimer()}},{key:"hideTimer",value:function(){var e=this;this.timeouts.hide=window.setTimeout((function(){e.shouldBeClosed&&e.hide()}),250)}},{key:"hideTimerCleaner",value:function(){window.clearTimeout(this.timeouts.hide)}},{key:"showTimer",value:function(){var e=this;this.timeouts.show=window.setTimeout((function(){e.show()}),250)}},{key:"showTimerCleaner",value:function(){window.clearTimeout(this.timeouts.show)}},{key:"updateMenuPosition",value:function(){var e=this,t=this.referenceElements.rightLimit,n=parseInt(window.getComputedStyle(t).getPropertyValue("padding-right"),10),i=!isNaN(n)&&isFinite(n),r=t.getBoundingClientRect().right-(i?n:0),s=this.triggerElement.getBoundingClientRect().right-r;this.targetElement.style.right="".concat(s,"px"),setTimeout((function(){return e.updateChevronPosition()}),0)}},{key:"updateChevronPosition",value:function(){var e=this.referenceElements.chevron.getBoundingClientRect(),t=[e.left+e.right]/2,n=this.triggerElement.getBoundingClientRect().right-t-parseInt(this.targetElement.style.right,10),i=document.querySelector(".user-menu__chevron");i.style.right="".concat((n-i.getBoundingClientRect().width/2).toFixed(),"px")}}])&&r(n.prototype,s),a&&r(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.UserMenuWidget=c;
