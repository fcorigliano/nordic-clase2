/**
 *
 */
const React = require('react');
const Script = require('frontend-script');
const { extractHostname, isSeo } = require('./util');

function getAttributionScript(browser, siteId, cdnDomain, mattTool, mattIgnore, internalReferrer, pageId, referrer) {
  const array = [];
  const referrerHostname = extractHostname(referrer);

  if (cdnDomain && siteId) {
    if (pageId === 'search-frontend' || pageId === 'search-nordic') {
      array.push(<Script src={`${cdnDomain}/storage/tag-manager/google-gtag-search-${siteId}.js`} />);
    } else if (browser && browser.name && browser.name.includes('safari') && parseInt(browser.major, 10) >= 12) {
      array.push(<Script src={`${cdnDomain}/storage/tag-manager/google-gtag-${siteId}.js`} />);
    }
  }

  if (!(mattIgnore === 'true') && !(internalReferrer === 'true')) {
    if (mattTool) {
      array.push(<Script src="nordic-attribution/lib-client/matt.js" inline />);
    } else if (isSeo(referrerHostname)) {
      array.push(<Script src="nordic-attribution/lib-client/mattorganic.js" inline />);
    } else if (!referrer) {
      array.push(<Script src="nordic-attribution/lib-client/mattdirect.js" inline />);
    }
  }

  return (array.length > 0) ? array : null;
}

/**
 * Expose getAttributionScript
 */
module.exports = getAttributionScript;
