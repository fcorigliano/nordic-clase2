# Prevent Open Redirect

> A middleware function to validate Open Redirects.

 If Open Redirect is not valid, the middleware redirect automatically to home of platform wich user navigate.

## Installation

```sh
npm install frontend-prevent-open-redirect
```

## Usage

You need [Ragnar](https://github.com/mercadolibre/frontend-ragnar) for this middleware because use **platform** information.

```js
/**
 * Module dependencies
 */
const router = require('ragnar').router();

const { preventOpenRedirect } = require('frontend-prevent-open-redirect');

router.get('/help', preventOpenRedirect(), (req, res, next) => {
  // This code execute if open redirect is valid
});

/**
 * Expose router
 */
module.exports = router;
```

### Configuration

`params`: (`string[]`): Indicate the names of params were contains the URIs for open redirect. By default is **go**

Example:

* https://www.mercadolibre.com.ar/...?go=https://www.mercadolibre.com.ar/&q=https://www.mercadopago.com.ar

`handleInvalidRedirectParam`: (`function`): This function handler in case if the open redirect is not valid, by default, redirect to home in same platform wich user navigate

`whitelist`:(`string[]`): If need valid externals domains you should add it here

`protocols`:(`string[]`): For customs protocols. Default: `'http:', 'https:', 'meli:', 'mercadopago:'`

#### Example

```js
/**
 * Module dependencies
 */
const router = require('ragnar').router();

const { preventOpenRedirect } = require('frontend-prevent-open-redirect');

const customConfig = {
  params: ['q', 'go'],
  handleInvalidRedirectParam: (req, res, next) => {
    // The invalid params are in res.locals.invalidParams
    const invalidParams = res.locals.invalidParams;
    const siteId = req.platform.siteId;

    res.redirect(`https://www.mercadolibre.com.ar/error?id=${siteId}`);
  },
  whitelist: ['www.google.com.ar', 'www.microsoft.com'],
  protocols: ['https:'],
};

router.get('/help', preventOpenRedirect(customConfig), (req, res, next) => {
  // This code execute if open redirect is valid
});

/**
 * Expose router
 */
module.exports = router;
```

## License

Copyright Â© 2021.
