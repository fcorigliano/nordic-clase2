# Auth URLs

## Table of Contents

- [Auth URLs](#auth-urls)
  - [Table of Contents](#table-of-contents)
  - [Description](#description)
  - [Installation](#installation)
  - [Usage](#usage)
    - [Customize URLs parameters](#customize-urls-parameters)
  - [License](#license)

## Description

Module that exposes methods to build **login**, **logout**, **registration** and **account access lite** URLs based on current request.

## Installation

```sh
npm i @auth/urls
```

## Usage

```js
const {
  getLoginURL,
  getLogoutURL,
  getRegistrationURL,
  getAccountAccessLiteURL,
} = require('@auth/urls');

// You need to pass Express' request object
const loginUrl = getLoginURL(request);
const logoutUrl = getLogoutURL(request);
const logoutUrl = getRegistrationURL(request);
```

### Customize URLs parameters

There are cases when you need to customize some parameters in the authentication urls (login, logout and registration). The following objects are available to configure the URLs parameters:

- `req.loginParams`: Object to customize the login url parameters.
  - `req.loginParams.platform_id`: Platform ID the login uses to render appropriate layout. Example: `mp`.
  - `req.loginParams.go`: URL to redirect to once the user successfully logs in. Defaults to current request URL.
  - `req.loginParams.loginType`: Used to tell the login its context. You can see a list of login types [here](https://github.com/mercadolibre/fury_auth-login-frontend/blob/7e7f7f4942e002c34551e9f9ed4871d9158eef8b/services/data/enums.js#L1).

- `req.logoutParams`: Object to customize the logout url parameters
  - `req.logoutParams.go`: URL to redirect to once the user logs out. Defaults to platform's home URL.

- `req.registrationParams`: Object to customize the registration url parameters.
  - `req.registrationParams.confirmation_url`: URL to redirect to once the user successfully registers. Defaults to current request URL.

- `req.accessLiteParams`: Object to customize the access account lite url parameters.
  - `req.accessLiteParams.callback_url`: URL to redirect to once the user gets a session.
  - `req.accessLiteParams.dps`: Session id. of device profile got by running profiling widget. Required from [AAL](https://github.com/mercadolibre/fury_account-access-lite-frontend).

For example, you can create a middleware like this:

```js
function setLoginParams(req, res, next) {
  req.loginParams = {
    loginType: 'cbt',
    go: 'https://example.org',
  };

  next();
}
```

If you are using the `authorization` middleware you must put your custom `setLoginParams` middleware before it.

```js
/**
 * Module dependencies
 */
const router = require('ragnar').router();
const authorization = require('nordic/auth');

/**
 * Default authorization strategy
 */
const defaultAuthorize = authorization();

/**
 * Set custom login parameters
 */
function setLoginParams(req, res, next) {
  req.loginParams = {
    loginType: 'cbt',
    go: 'https://example.org',
  };

  next();
}

/**
 * Use default authorization
 */
router.get('/custom-params', setLoginParams, defaultAuthorize, function (req, res) {
  // ...
});

/**
 * Expose router
 */
module.exports = router;
```

## License

Â© 2021 Mercado Libre - Account Security
