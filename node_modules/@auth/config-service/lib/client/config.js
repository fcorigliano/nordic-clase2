"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchConfig = void 0;
const frontend_env_1 = require("frontend-env");
const frontend_restclient_1 = require("frontend-restclient");
const constants_1 = require("../constants");
const metrics_1 = require("./metrics");
const restClient = (0, frontend_restclient_1.RestClient)({
    timeout: frontend_env_1.PRODUCTION ? 300 : 3000,
    headers: {
        'user-agent': constants_1.CLIENT_UA,
        'content-type': 'application/json;charset=utf-8',
    },
});
const TEST_SCOPE = frontend_env_1.AUTH_CONFIG_UPDATE?.startsWith('scope_') && frontend_env_1.AUTH_CONFIG_UPDATE.substring(6);
const fetchConfig = (params) => {
    const data = params;
    const startTime = Date.now();
    return restClient.post('/internal/auth/configurations', {
        data,
        context: (0, frontend_restclient_1.buildFlowStarterContext)(),
        ...TEST_SCOPE && { params: { version: TEST_SCOPE } },
    })
        .then((res) => {
        (0, metrics_1.logAPICallToDatadog)({ startTime });
        return res.data;
    })
        .catch((err) => {
        (0, metrics_1.logAPICallToDatadog)({ startTime, error: err });
        throw err;
    });
};
exports.fetchConfig = fetchConfig;
