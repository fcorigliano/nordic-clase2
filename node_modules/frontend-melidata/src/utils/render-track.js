const melidataTrack = require('../templates/melidata-track');
const melidataTrackTest = require('../templates/melidata-track-test');
const CatalogValidator = require('../catalog/catalog-validator');

const { NODE_ENV } = process.env;

function render(data) {
  // Do not validate the track in production or test environments
  if (['production', 'test'].includes(NODE_ENV)) {
    return Promise.resolve(melidataTrack(data));
  }

  const catalogValidator = new CatalogValidator();
  return catalogValidator.checkCatalog(data.track)
    .then((validation) => {
      data.validation = validation;

      return melidataTrackTest(data);
    });
}

module.exports = render;
