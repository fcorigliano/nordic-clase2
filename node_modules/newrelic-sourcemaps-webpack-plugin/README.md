# newrelic-sourcemaps-webpack-plugin
Upload source maps to Newrelic as part of a webpack build.

**Note**: this is the port of the official [new-relic-source-map-webpack-plugin](https://github.com/1stdibs/new-relic-source-map-webpack-plugin).
  It is oriented to the Nordic pipeline and includes some automated steps related to the the Fury environment.

## Install

`npm install newrelic-sourcemaps-webpack-plugin --save-dev`

## Setup

Instantiate the plugin and add it to your plugins array.

`applicationId`, `apiKey`, and `publicPath` are required unless `noop` is `true`.  Full list of options in the next section. Also please read carefully the [Configuration notes](#configuration-notes) section that explains when `applicationId` and `apiKey` may be omitted.

```js
const NewrelicSourcemapsPlugin = require('newrelic-sourcemaps-webpack-plugin');

module.exports = {
    ...webpackConfig,
    plugins: [
        ...yourPlugins,
        new NewRelicSourceMapPlugin({
            publicPath: 'https://http2.mlstatic.com/storage/application-name/',
            applicationId: 'YOUR NEWRELIC APP ID',
            apiKey: 'YOUR NEWRELIC ADMIN KEY',
            noop: process.env.NODE_ENV !== 'production' || process.env.platform !== 'fury', // upload source maps in production builds only and only during builds on Fury
        }),
    ],
}
```

## Configure

| Property              | Type                 | Description  |
| --------------------- | :------------------- | :----------- |
| publicPath            | string               | A base path for all the assets within your application written as a complete url. Example: "https://http2.mlstatic.com/storage/application-name/" | |
| staticAssetUrlBuilder | function             | [Optional] A function for building the production url your js file is built from.  Will be called for every javascript file with three arguments: the public path from your webpack config, the filename, and the [webpack stats instance](https://github.com/webpack/webpack/blob/master/lib/Stats.js).  Defaults to `${publicPath}/${file}` |
| applicationName       | string               | [Optional] applicationName is an alias of you your application, typically is the same as defi |
| applicationId         | string|Array<string> | [Optional] Single applicationId or an array of applicationId as defined [here](https://docs.newrelic.com/docs/browser/new-relic-browser/installation-configuration/copy-browser-monitoring-license-key-app-id) |
| apiKey            | string               | [Optional] Admin Key as defined [here](https://docs.newrelic.com/docs/apis/rest-api-v2/requirements/api-keys) |
| extensionRegex        | regex                | [Optional] A regex used to find js files. Defaults to `/\.js$/` |
| releaseName           | string               | [Optional] unique identifier for the release name |
| releaseId             | string               | [Optional] unique version for the release identifier |
| noop                  | boolean              | [Optional] Control boolean that decides whether or not to run the plugin. Set to true for builds where you don't want to upload assets to new relic. |

### Configuration notes

- In a normal Fury application only `publicPath` is required since the most of options have some reasonable defaults or may be resolved during the build time
- Outside of Fury environment `applicationId` or `applicationName` is also required since its value depends on `process.env.APPLICATION` env variable that may not be defined
- `applicationId` is optional but it is highly recommended, by indicating only important application scopes you can avoid unnecessary communication and speed-up the build times. 
- By default is used `apiKey` of "Fury ML" account, if you want to upload sourcemaps to a different Newrelic account  `apiKey` is also required
- `noop` by default has a dynamic default value, it enables the sourcemap upload only for production builds in Fury environment while locally it is always `true`
- If you're using `releaseName` and `releaseId`, make sure one or both are unique per build and
that you use the [`newrelic.addRelease`](https://docs.newrelic.com/docs/browser/new-relic-browser/browser-agent-spa-api/add-release) method in your code to identify the release.
