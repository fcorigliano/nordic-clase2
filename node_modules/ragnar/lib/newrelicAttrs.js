/**
 * Module dependencies
 */
const newrelic = require('newrelic');

/**
 * Expose newrelic Attrs middleware
 */
const webview = (req, res, next) => {
  if (req.device && req.device.webView && req.device.nativeApp && newrelic.addCustomAttributes) {
    newrelic.addCustomAttributes({
      nativeAppName: req.device.nativeApp.name,
      nativeAppOs: req.device.nativeApp.os,
      nativeAppVersion: req.device.nativeApp.version,
    });
  }

  next();
};

const newrelicAttrs = () => [webview];

module.exports = { newrelicAttrs, webview };
