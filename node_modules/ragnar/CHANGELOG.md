# Changelog

## Next release

## 3.9.0

- [#104](https://github.com/mercadolibre/fury_frontend-ragnar/pull/104) Make session cookie secure by default
- [#101](https://github.com/mercadolibre/fury_frontend-ragnar/pull/101) Add 404 http error page to router if applies for Nordic Page

## 3.8.2

- [#100](https://github.com/mercadolibre/fury_frontend-ragnar/pull/100) Add pageMiddleware error type to hold the stack.

## 3.8.1

- [#97](https://github.com/mercadolibre/fury_frontend-ragnar/pull/97) add csrf token into Etag key.

## 3.8.0

- [#96](https://github.com/mercadolibre/fury_frontend-ragnar/pull/96) Bump session-anomalies lib to `^1.1.0` and require frontend-authentication `^5.4.0`

## 3.7.1

- [#94](https://github.com/mercadolibre/fury_frontend-ragnar/pull/94) [Nordic page] change the name of the `state` property to `pageState` since the property is used by layout inside `layoutOptions.state`. The state property of layout will be deprecated in the future.

## 3.7.0

- [#41](https://github.com/mercadolibre/fury_frontend-ragnar/pull/41) Add Nordic Page feature

  - [#92](https://github.com/mercadolibre/fury_frontend-ragnar/pull/92) Track business metrics of nordic pages using NewRelic

  - [#83](https://github.com/mercadolibre/fury_frontend-ragnar/pull/83) Remove use of experimental.nordicPages to enable the feature

  - [#87](https://github.com/mercadolibre/fury_frontend-ragnar/pull/87) Move Pretty Error Layer after Nordic Pages in router

  - [#85](https://github.com/mercadolibre/fury_frontend-ragnar/pull/85) Apply renamings of Nordic Page

  - [#81](https://github.com/mercadolibre/fury_frontend-ragnar/pull/81) Implement onPageError and beforeSend on Nordic pages

  - [#80](https://github.com/mercadolibre/fury_frontend-ragnar/pull/80) Change Nordic Page middleware strategy and rename middleware to hooks

  - [#78](https://github.com/mercadolibre/fury_frontend-ragnar/pull/78) Change middlewares to middleware on nordicPage

  - [#74](https://github.com/mercadolibre/fury_frontend-ragnar/pull/74) Add handle errors for wrong type and export of page component in Nordic Page

  - [#73](https://github.com/mercadolibre/fury_frontend-ragnar/pull/73) Track errors in production of nordic page using NewRelic

  - [#71](https://github.com/mercadolibre/fury_frontend-ragnar/pull/71) Add webview to supported nordic page device types

  - [#69](https://github.com/mercadolibre/fury_frontend-ragnar/pull/69) Refactor params of setPageConfiguration

  - [#68](https://github.com/mercadolibre/fury_frontend-ragnar/pull/68) Add error handlers for setPageConfiguration, getServerSideProps and middlewares

  - [#64](https://github.com/mercadolibre/fury_frontend-ragnar/pull/64) Add beforeFetch and beforeRender middlewares to nordic pages

  - [#63](https://github.com/mercadolibre/fury_frontend-ragnar/pull/63) Change view imports to use ECMA and client naming used in sourcemap entrypoints for nordicpages

  - [#62](https://github.com/mercadolibre/fury_frontend-ragnar/pull/62) Send isLegacyBrowser to page

  - [#61](https://github.com/mercadolibre/fury_frontend-ragnar/pull/61) Change hydrateClient naming to runtimeJS

  - [#60](https://github.com/mercadolibre/fury_frontend-ragnar/pull/60) Add getServerSideProps, setPageConfiguration and render middlewares for Nordic Pages

  - [#58](https://github.com/mercadolibre/fury_frontend-ragnar/pull/58) Add imagesPrefix property for ImageProvider support.

  - [#57](https://github.com/mercadolibre/fury_frontend-ragnar/pull/57) Adapt ragnar to new route discovery return format

  - [#54](https://github.com/mercadolibre/fury_frontend-ragnar/pull/54) Require getInitialProps and getRenderOptions
    - Rename getInitialProps and getRenderOptions to getServerSideProps and setPageConfiguration 
    - Require getServerSideProps and setPageConfiguration

  - [#53](https://github.com/mercadolibre/fury_frontend-ragnar/pull/53) Take layoutOptions, navigationOptions and done from renderOptions

  - [#48](https://github.com/mercadolibre/fury_frontend-ragnar/pull/48) Add i18n to props on NordicPage and check for the page name before render

  - [#47](https://github.com/mercadolibre/fury_frontend-ragnar/pull/47) Add getRenderOptions to set render specifications of nordic page children

  - [#45](https://github.com/mercadolibre/fury_frontend-ragnar/pull/45) Add getInitialProps to set state properties of nordic page children

  - [#41](https://github.com/mercadolibre/fury_frontend-ragnar/pull/41)Â Append dynamic pages when using nordic pages and experimental.nordicPages configuration is true

- Update internal dependencies
  - @dynamic-content-libs/dynamic-content-api-middleware@2.3.1
  - @frontend-cookies-manager/cookies-helpers-middleware@2.6.0
  - @frontend-cookies-manager/http-cookies-middleware@2.6.0
  - frontend-i18n@4.6.0
  - frontend-page@2.1.0

## 3.6.1

- [#89](https://github.com/mercadolibre/fury_frontend-ragnar/pull/89) Update [`@auth/session-anomalies`](https://github.com/mercadolibre/fury_auth-session-anomalies-lib) to [v1.0.4](https://github.com/mercadolibre/fury_auth-session-anomalies-lib/releases/tag/1.0.4)
- Update internal dependencies
  - @frontend-cookies-manager/cookies-helpers-middleware@2.5.1
  - @frontend-cookies-manager/http-cookies-middleware@2.5.1

## 3.6.0

- [#82](https://github.com/mercadolibre/fury_frontend-ragnar/pull/82) Bump mshops-detection to v2.2.0
- [#79](https://github.com/mercadolibre/fury_frontend-ragnar/pull/79) Hot reload dependencies update.
- [#77](https://github.com/mercadolibre/fury_frontend-ragnar/pull/77) Get dynamic-content-api-middleware from dynamic-content-libs

## 3.5.0

- [#75](https://github.com/mercadolibre/fury_frontend-ragnar/pull/75) Update [`@auth/session-anomalies`](https://github.com/mercadolibre/fury_auth-session-anomalies-lib) to [v1.0.3](https://github.com/mercadolibre/fury_auth-session-anomalies-lib/releases/tag/1.0.3)
- [#72](https://github.com/mercadolibre/fury_frontend-ragnar/pull/72) Support esmodules/commonjs in hotreload

## 3.4.1

- [#67](https://github.com/mercadolibre/fury_frontend-ragnar/pull/67) Update [`@auth/session-anomalies`](https://github.com/mercadolibre/fury_auth-session-anomalies-lib) to [v1.0.2](https://github.com/mercadolibre/fury_auth-session-anomalies-lib/releases/tag/1.0.2)

## 3.4.0

- [#65](https://github.com/mercadolibre/fury_frontend-ragnar/pull/65) Add [`@auth/session-anomalies`](https://github.com/mercadolibre/fury_auth-session-anomalies-lib) middleware
- [#55](https://github.com/mercadolibre/fury_frontend-ragnar/pull/55) Added middleware to allow awaiting for promises to resolve before ending response
- Update internal dependencies
  - frontend-restclient@4.4.0
  - frontend-platform_detection@2.2.0
  - @frontend-cookies-manager/cookies-helpers-middleware@2.2.1
  - @frontend-cookies-manager/dynamic-content-api-middleware@2.2.1
  - @frontend-cookies-manager/http-cookies-middleware@2.2.1
  - nordic-telemetry@2.0.1

## 3.3.0

- [#50](https://github.com/mercadolibre/fury_frontend-ragnar/pull/50) Apply csurf middleware even if path is ignored by config
- [#51](https://github.com/mercadolibre/fury_frontend-ragnar/pull/51) Return 403 instead of 500 in default appErrorHandler

## 3.2.0

- [#35](https://github.com/mercadolibre/fury_frontend-ragnar/pull/35) Added middleware to check user third party permission switch button status (denied or not denied)

## 3.1.0

- [#36](https://github.com/mercadolibre/fury_frontend-ragnar/pull/36) Add ignorePaths to csrf config to explicitly ignore endpoints

## 3.0.2

- Update internal dependencies
  - @frontend-cookies-manager/cookies-helpers-middleware@2.0.2
  - @frontend-cookies-manager/dynamic-content-api-middleware@2.0.2
  - @frontend-cookies-manager/http-cookies-middleware@2.0.2

## 3.0.1

- [#29](https://github.com/mercadolibre/fury_frontend-ragnar/pull/29) Increase server keepAliveTimeout to 75s

## 3.0.0

- [#24](https://github.com/mercadolibre/fury_frontend-ragnar/pull/24) Major release changes :point_down:

### :warning: **Breaking changes:**
  - Minimum supported `Node.js` version is `14`

### **Other changes:**
  - [#15](https://github.com/mercadolibre/fury_frontend-ragnar/pull/15) CSRF By Default: Add `csurf` middleware enabled by default.
  - peerDependencies have been removed and moved to module dependencies/devDependencies.

### **Highlighted external dependencies updates:**

- `helmet` -> [4.6.0](https://github.com/helmetjs/helmet/blob/main/CHANGELOG.md#460---2021-05-01)
  The previous installed version of [helmet@3.21.1](https://github.com/helmetjs/helmet/blob/main/CHANGELOG.md#3211---2019-09-20) only overrides two of the default configured middlewares, those are `frameguard` and  `dnsPrefetchControl`. `Ragnar@3.x` updates `helmet` to `4.6.0` and this new version turns on some middleware options. Those options were evaluated along with the web security team and determined the follow values:
    - `contentSecurityPolicy`: by default it will be disabled and you will have the option to configure it [in the same way as you can today](https://github.com/mercadolibre/fury_frontend-ragnar/blob/master/lib/csp.js#L51).
    - [expectCt](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT): by default it will be disabled, this information already comes in the certificates.
    - [permittedCrossDomainPolicies](https://www.npmjs.com/package/helmet-crossdomain): the helmet default value (`permittedPolicies`: `'none'`) will be inherit as it only affects the loading of Adobe products.
    - [referrerPolicy](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy): since some applications use the referer value and stop propagating it (or at least only allow company's domain) will be a breaking change that is out of this scope, the **frontend-rules** current value will be taken:  `policy`: `'no-referrer-when-downgrade'`

    [Helmet middleware options reference](https://helmetjs.github.io/#reference).

- `uuid` -> [8.3.2](https://github.com/uuidjs/uuid/blob/master/CHANGELOG.md#832-2020-12-08)
  - The new version remove the default export in favor of named export: `const { v4: uuidv4 } = require('uuid');`

- `statuses` -> [2.0.1](https://github.com/jshttp/statuses/blob/d6b7ddc474bd621bb9539b611e4da9dfd845d30e/HISTORY.md#201--2021-01-03)
  - Minimum changes required due to the change: >> Remove status[code] exports; use status.message[code]

- `newrelic` -> [7.x](https://github.com/newrelic/node-newrelic/releases/tag/v7.0.0)
  - The use of newrelic in ragnar is compatible with the major new version.

- `chokidar` -> [3.5.2](https://github.com/paulmillr/chokidar/releases/tag/3.5.2)
  - An internal dependency was updated in order to fix a possible vulnerability.

### **Internal dependencies updates:**

- `@frontend-cookies-manager` -> [2.0.1](https://github.com/mercadolibre/fury_frontend-cookies-manager/releases/tag/2.0.1)
- `cbt-users-middleware` -> [2.0.0](https://github.com/mercadolibre/fury_cbt-users-middleware/blob/master/CHANGELOG.md#200---2021-07-14)
- `first-party-detection` -> [2.0.0](https://github.com/mercadolibre/fury_first-party-detection/releases/tag/2.0.0)
- `frontend-authentication` -> [5.0.1](https://github.com/mercadolibre/fury_frontend-authentication/releases/tag/5.0.1)
- `frontend-config` -> [2.0.0](https://github.com/mercadolibre/fury_frontend-config/releases/tag/2.0.0)
- `frontend-devcert` -> [2.0.1](https://github.com/mercadolibre/fury_frontend-devcert/releases/tag/2.0.1)
- `frontend-device_detection` -> [2.1.1](https://github.com/mercadolibre/fury_frontend-device-detection/releases/tag/2.1.1)
- `frontend-env` -> [3.0.2](https://github.com/mercadolibre/fury_frontend-env/releases/tag/3.0.0)
- `frontend-logger` -> [2.0.0](https://github.com/mercadolibre/fury_frontend-logger/releases/tag/2.0.0)
- `frontend-mshops-detection` -> [2.0.0](https://github.com/mercadolibre/fury_frontend-mshops-detection/blob/master/CHANGELOG.md#200---2021-07-02)
- `frontend-platform_detection` -> [2.0.0](https://github.com/mercadolibre/fury_frontend-platform-detection/releases/tag/2.0.0)
- `frontend-restclient` -> [4.0.2](https://github.com/mercadolibre/fury_frontend-restclient/releases/tag/4.0.2)
- `frontend-statsd` -> [2.0.1](https://github.com/mercadolibre/fury_frontend-statsd/releases/tag/2.0.0)
- `fury-session` -> [2.0.0](https://github.com/mercadolibre/fury_node-express-session/releases/tag/2.0.0)
- `nordic-telemetry` -> [2.0.0](https://github.com/mercadolibre/fury_nordic-telemetry/releases/tag/2.0.0)

## 2.5.0

- [#26](https://github.com/mercadolibre/fury_frontend-ragnar/pull/26) Feature: added `ignoredFiles` option to be able to ignore files/folders to be watched when running hot-reload & fast-refresh.
- Update internal dependencies
  - @frontend-cookies-manager/cookies-helpers-middleware@1.1.10
  - @frontend-cookies-manager/dynamic-content-api-middleware@1.1.10
  - @frontend-cookies-manager/http-cookies-middleware@1.1.10

## 2.4.4

- Update internal dependencies
  - @frontend-cookies-manager/cookies-helpers-middleware@1.1.5
  - @frontend-cookies-manager/dynamic-content-api-middleware@1.1.5
  - @frontend-cookies-manager/http-cookies-middleware@1.1.5

## 2.4.3

- Update internal dependencies
  - @frontend-cookies-manager/cookies-helpers-middleware@1.0.46
  - @frontend-cookies-manager/dynamic-content-api-middleware@1.0.46
  - @frontend-cookies-manager/http-cookies-middleware@1.0.46
  - frontend-mshops-detection@1.6.2

## 2.4.2

- [#20](https://github.com/mercadolibre/fury_frontend-ragnar/pull/20) Fix: attach common app config when hot reload server config

## 2.4.1

- [#18](https://github.com/mercadolibre/fury_frontend-ragnar/pull/18) Update frontend-cookies-manager to [1.0.42](https://github.com/mercadolibre/fury_frontend-cookies-manager/releases/tag/1.0.42) and use ^ on them
- [#17](https://github.com/mercadolibre/fury_frontend-ragnar/pull/17) Fix typo
- [#16](https://github.com/mercadolibre/fury_frontend-ragnar/pull/16) Improve the devcert server message

## 2.4.0

- [#13](https://github.com/mercadolibre/fury_frontend-ragnar/pull/13) Add cookies helpers and dynamic content middlewares
- [#9](https://github.com/mercadolibre/fury_frontend-ragnar/pull/9) Implement frontend-devcert to dynamically generate certificates in development environment
- [#4](https://github.com/mercadolibre/fury_frontend-ragnar/pull/4) Fast refresh feature

## 2.3.2

- [#11](https://github.com/mercadolibre/fury_frontend-ragnar/pull/11) Update HTTP cookies tracking middleware to [1.0.1](https://github.com/mercadolibre/fury_frontend-cookies-manager/releases/tag/1.0.1)

## 2.3.1

- [#7](https://github.com/mercadolibre/fury_frontend-ragnar/pull/7) Update the links of the submodules in the readme

## 2.3.0

- [#5](https://github.com/mercadolibre/fury_frontend-ragnar/pull/5) Add HTTP cookies tracking middleware

## 2.2.0

- [#2](https://github.com/mercadolibre/fury_frontend-ragnar/pull/2) Traceability: Add context to suspicious traffic request

## 2.1.2

- [#127](https://github.com/mercadolibre/frontend-ragnar/pull/127) Update first-party-detection version.

## 2.1.1

- [#125](https://github.com/mercadolibre/frontend-ragnar/pull/125) Fix site Id.
- [#124](https://github.com/mercadolibre/frontend-ragnar/pull/124) Cookie samesite handler fix null platform.

## 2.1.0

- [#117](https://github.com/mercadolibre/frontend-ragnar/pull/117) Fix types for optional params in Ragnar initialization.
- [#119](https://github.com/mercadolibre/frontend-ragnar/pull/119) Add validations to OutdatedBrowser middleware
- [#120](https://github.com/mercadolibre/frontend-ragnar/pull/120) Add First Party middleware

## 2.0.2

- Update semver minimum version to assure ragnar has fixed Access Token. [Changelog](https://github.com/mercadolibre/fury_frontend-authentication/blob/master/CHANGELOG.md#430)
- Updated to [frontend-restclient@3.0.0](https://github.com/mercadolibre/frontend-restclient/releases/tag/v3.0.0)

## 2.0.1

- [#114](https://github.com/mercadolibre/frontend-ragnar/pull/114) Check platform use in outdated browser

## 2.0.0

- frontend-authentication: Upgrade to v4.2.0 IFPE, Restrict admins to specific request methods. [Changelog](https://github.com/mercadolibre/fury_frontend-authentication/blob/master/CHANGELOG.md#420)
- [#110](https://github.com/mercadolibre/frontend-ragnar/pull/110) Fix: Types in declaration files and add typescript to check this file
- [#109](https://github.com/mercadolibre/frontend-ragnar/pull/109) Feature: Outdated browser middleware

## 1.15.1

- Updated fury-session module

## 1.15.0

- [#99](https://github.com/mercadolibre/frontend-ragnar/pull/99)[#100](https://github.com/mercadolibre/frontend-ragnar/pull/100) Feature: Added type declaration file
- [#98](https://github.com/mercadolibre/frontend-ragnar/pull/98) Fix: Respose cookie method chained calls

## 1.14.1

- [#96](https://github.com/mercadolibre/frontend-ragnar/pull/96) Fix: Secure validation cookie samesite

## 1.14.0

- [#88](https://github.com/mercadolibre/frontend-ragnar/pull/88) Feature: Added custom shared middlewares
- [#93](https://github.com/mercadolibre/frontend-ragnar/pull/93) Feature: Cookie SameSite response

## 1.13.0

- [#91](https://github.com/mercadolibre/frontend-ragnar/pull/91) Update [frontend-authentication](https://github.com/mercadolibre/frontend-ragnar/pull/91) URL in READMEs
- [#90](https://github.com/mercadolibre/frontend-ragnar/pull/90) Add info from device webviews to newrelic custom attributes

## 1.12.0

- [#87](https://github.com/mercadolibre/frontend-ragnar/pull/87) Feature: Add preventRenderByEtag middleware
- [#83](https://github.com/mercadolibre/frontend-ragnar/pull/83) Upgrade ragnar dependencies

## 1.11.0

- [#85](https://github.com/mercadolibre/frontend-ragnar/pull/85) Feature: Added flag for disabling clustering

## 1.10.1

- [#84](https://github.com/mercadolibre/frontend-ragnar/pull/84) Release ragnar@1.10.1: Upgraded fury-session to v1.3.2 which updates kvsclient [v1.2.1](https://github.com/mercadolibre/fury_node-kvsclient/releases/tag/v1.2.1)

## 1.10.0

- [#80](https://github.com/mercadolibre/frontend-ragnar/pull/80) Feature: Add cbt middleware

## 1.9.3

- [#78](https://github.com/mercadolibre/frontend-ragnar/pull/78) Put device before platform and mshops detection
- [#79](https://github.com/mercadolibre/frontend-ragnar/pull/79)
Update dependency to fury-session@1.3.1
